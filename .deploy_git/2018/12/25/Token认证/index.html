
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
  
    <title>Token认证 | 爱撒谎的男孩</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="不才陈某">
    

    
    <meta name="description" content="认证机制常见的几种认证机制HTTP Basic Auth
在HTTP中，HTTP基本认证是一种允许Web浏览器或者其他客户端在请求时提供用户名和口令形式的身份凭证的一种登录验证方式。
简单而言，HTTP基本认证就是我们平时在网站中最常用的通过用户名和密码登录来认证的机制。 就是每次请求都会带上用户名和密码
优点 

HTTP 基本认证是基本上所有流行的网页浏览器都支持。但是基本认证很少在可公开访问">
<meta property="og:type" content="article">
<meta property="og:title" content="Token认证">
<meta property="og:url" content="http://chenjiabing666.github.io/2018/12/25/Token认证/index.html">
<meta property="og:site_name" content="爱撒谎的男孩">
<meta property="og:description" content="认证机制常见的几种认证机制HTTP Basic Auth
在HTTP中，HTTP基本认证是一种允许Web浏览器或者其他客户端在请求时提供用户名和口令形式的身份凭证的一种登录验证方式。
简单而言，HTTP基本认证就是我们平时在网站中最常用的通过用户名和密码登录来认证的机制。 就是每次请求都会带上用户名和密码
优点 

HTTP 基本认证是基本上所有流行的网页浏览器都支持。但是基本认证很少在可公开访问">
<meta property="og:image" content="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg">
<meta property="og:updated_time" content="2020-03-13T06:19:43.101Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Token认证">
<meta name="twitter:description" content="认证机制常见的几种认证机制HTTP Basic Auth
在HTTP中，HTTP基本认证是一种允许Web浏览器或者其他客户端在请求时提供用户名和口令形式的身份凭证的一种登录验证方式。
简单而言，HTTP基本认证就是我们平时在网站中最常用的通过用户名和密码登录来认证的机制。 就是每次请求都会带上用户名和密码
优点 

HTTP 基本认证是基本上所有流行的网页浏览器都支持。但是基本认证很少在可公开访问">
<meta name="twitter:image" content="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg">

    
    <link rel="alternative" href="/atom.xml" title="爱撒谎的男孩" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/avatar.jpg" alt="爱撒谎的男孩" title="爱撒谎的男孩"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="爱撒谎的男孩">爱撒谎的男孩</a></h1>
				<h2 class="blog-motto">微信公众号：码猿技术专栏</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives/">归档</a></li>
					
						<li><a href="/about/">关于我</a></li>
					
					<li>
 					
						<form class="search" action="https://chenjiabing666.github.io/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 14509119671822170000 ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>	
			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/25/Token认证/" title="Token认证" itemprop="url">Token认证</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="不才陈某" target="_blank" itemprop="author">不才陈某</a>
		
  <p class="article-time">
    <time datetime="2018-12-24T16:13:57.000Z" itemprop="datePublished"> 发表于 2018-12-25</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#认证机制"><span class="toc-number">1.</span> <span class="toc-text">认证机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的几种认证机制"><span class="toc-number">1.1.</span> <span class="toc-text">常见的几种认证机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-Basic-Auth"><span class="toc-number">1.1.1.</span> <span class="toc-text">HTTP Basic Auth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth（开放授权）"><span class="toc-number">1.1.2.</span> <span class="toc-text">OAuth（开放授权）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie-Session-认证机制"><span class="toc-number">1.1.3.</span> <span class="toc-text">Cookie/Session 认证机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于-Token-的认证机制"><span class="toc-number">1.1.4.</span> <span class="toc-text">基于 Token 的认证机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有状态服务和无状态服务"><span class="toc-number">1.1.5.</span> <span class="toc-text">有状态服务和无状态服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于JWT（JSON-WEB-TOKEN）的Token认证机制实现"><span class="toc-number">1.2.</span> <span class="toc-text">基于JWT（JSON WEB TOKEN）的Token认证机制实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#头部（Header）"><span class="toc-number">1.2.1.</span> <span class="toc-text">头部（Header）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#载荷（Payload）"><span class="toc-number">1.2.2.</span> <span class="toc-text">载荷（Payload）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#签名（Signature）"><span class="toc-number">1.2.3.</span> <span class="toc-text">签名（Signature）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JJWT"><span class="toc-number">1.3.</span> <span class="toc-text">JJWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加依赖"><span class="toc-number">1.3.1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成token"><span class="toc-number">1.3.2.</span> <span class="toc-text">生成token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解析token"><span class="toc-number">1.3.3.</span> <span class="toc-text">解析token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置过期时间"><span class="toc-number">1.3.4.</span> <span class="toc-text">设置过期时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加自定义属性"><span class="toc-number">1.3.5.</span> <span class="toc-text">添加自定义属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在拦截器中配置"><span class="toc-number">1.4.</span> <span class="toc-text">在拦截器中配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT工具类"><span class="toc-number">1.4.1.</span> <span class="toc-text">JWT工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置文件"><span class="toc-number">1.4.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器"><span class="toc-number">1.4.3.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置拦截器"><span class="toc-number">1.4.4.</span> <span class="toc-text">配置拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">1.4.5.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#相关问题"><span class="toc-number">1.5.</span> <span class="toc-text">相关问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发流程"><span class="toc-number">1.6.</span> <span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码"><span class="toc-number">1.7.</span> <span class="toc-text">源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-number">1.8.</span> <span class="toc-text">参考文章</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#笔者有话说"><span class="toc-number">1.9.</span> <span class="toc-text">笔者有话说</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="认证机制"><a href="#认证机制" class="headerlink" title="认证机制"></a>认证机制</h1><h2 id="常见的几种认证机制"><a href="#常见的几种认证机制" class="headerlink" title="常见的几种认证机制"></a>常见的几种认证机制</h2><h3 id="HTTP-Basic-Auth"><a href="#HTTP-Basic-Auth" class="headerlink" title="HTTP Basic Auth"></a>HTTP Basic Auth</h3><ul>
<li>在HTTP中，HTTP基本认证是一种允许Web浏览器或者其他客户端在请求时提供用户名和口令形式的身份凭证的一种登录验证方式。</li>
<li><strong>简单而言，HTTP基本认证就是我们平时在网站中最常用的通过用户名和密码登录来认证的机制。 就是每次请求都会带上用户名和密码</strong></li>
<li><p>优点 </p>
<ul>
<li>HTTP 基本认证是基本上所有流行的网页浏览器都支持。但是基本认证很少在可公开访问的互联网网站上使用，有时候会在小的私有系统中使用。 </li>
<li>适用于各种平台，包括app和web</li>
</ul>
</li>
<li><p>缺点 </p>
<ul>
<li>HTTP 基本认证虽然足够简单，但是前提是在客户端和服务器主机之间的连接足够安全。如果没有使用SSL/TLS这样的传输层安全的协议，那么以明文传输的密钥和口令很容易被拦截。 </li>
<li>由于现存的浏览器保存认证信息直到标签页或浏览器关闭，或者用户清除历史记录。导致了服务器端无法主动来当前用户登出或者认证失效。</li>
</ul>
</li>
</ul>
<h3 id="OAuth（开放授权）"><a href="#OAuth（开放授权）" class="headerlink" title="OAuth（开放授权）"></a>OAuth（开放授权）</h3><ul>
<li>OAuth 是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表等），而无需将用户名和密码提供给第三方应用。 </li>
<li>OAuth 允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站）在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容。</li>
<li><strong>最常见的就是qq和微信授权登录</strong> </li>
</ul>
<h3 id="Cookie-Session-认证机制"><a href="#Cookie-Session-认证机制" class="headerlink" title="Cookie/Session 认证机制"></a>Cookie/Session 认证机制</h3><ul>
<li>Cookie 是由客户端保存的小型文本文件，其内容为一系列的键值对。Cookie 是由 HTTP 服务器设置的，保存在浏览器中。Cookie会随着 HTTP请求一起发送。 </li>
<li>Session 是存储在服务器端的，避免在客户端 Cookie 中存储敏感数据。Session 可以存储在 HTTP 服务器的内存中，也可以存在内存数据库（如redis）中。 </li>
<li>Cookie/Session认证机制就是为一次请求认证在服务端创建一个Session对象，同时在客户端的浏览器端创建了一个Cookie对象；通过客户端带上来Cookie对象来与服务器端的session对象匹配来实现状态管理的。默认的，当我们关闭浏览器的时候，cookie会被删除。但可以通过修改cookie 的expire time使cookie在一定时间内有效</li>
<li>缺点：<ul>
<li>平台有限，不适合App端</li>
<li>数据量过大的话，对服务器会造成负担</li>
</ul>
</li>
</ul>
<h3 id="基于-Token-的认证机制"><a href="#基于-Token-的认证机制" class="headerlink" title="基于 Token 的认证机制"></a>基于 Token 的认证机制</h3><ul>
<li>Token机制相对于Cookie机制又有什么好处呢？<ul>
<li><strong>支持跨域访问</strong>: Cookie是不允许垮域访问的，这一点对Token机制是不存在的，前提是传输的用户认证信息通过HTTP头传输.</li>
<li><strong>无状态(也称：服务端可扩展行)</strong>:Token机制在服务端不需要存储session信息，因为Token 自身包含了所有登录用户的信息，只需要在客户端的cookie或本地介质存储状态信息.</li>
<li><strong>更适用CDN</strong>: 可以通过内容分发网络请求你服务端的所有资料（如：javascript，HTML,图片等），而你的服务端只要提供API即可.</li>
<li><strong>去耦</strong>: 不需要绑定到一个特定的身份验证方案。Token可以在任何地方生成，只要在你的API被调用的时候，你可以进行Token生成调用即可.</li>
<li><strong>更适用于移动应用</strong>: 当你的客户端是一个原生平台（iOS, Android，Windows 8等）时，Cookie是不被支持的（你需要通过Cookie容器进行处理），这时采用Token认证机制就会简单得多。</li>
<li><strong>CSRF</strong>:因为不再依赖于Cookie，所以你就不需要考虑对CSRF（跨站请求伪造）的防范。</li>
<li><strong>性能</strong>: 一次网络往返时间（通过数据库查询session信息）总比做一次HMACSHA256计算 的Token验证和解析要费时得多.</li>
<li><strong>不需要为登录页面做特殊处理</strong>: 如果你使用Protractor 做功能测试的时候，不再需要为登录页面做特殊处理.</li>
<li><strong>基于标准化</strong>:你的API可以采用标准化的 JSON Web Token (JWT). 这个标准已经存在多个后端库（.NET, Ruby, Java,Python, PHP）和多家公司的支持（如：Firebase,Google, Microsoft）.</li>
</ul>
</li>
</ul>
<h3 id="有状态服务和无状态服务"><a href="#有状态服务和无状态服务" class="headerlink" title="有状态服务和无状态服务"></a>有状态服务和无状态服务</h3><ul>
<li><strong>无状态服务</strong>:就是没有特殊状态的服务,各个请求对于服务器来说统一无差别处理,请求自身携带了所有服务端所需要的所有参数(服务端自身不存储跟请求相关的任何数据,不包括数据库存储信息) </li>
<li><strong>有状态服务</strong>:与之相反,有状态服务在服务端保留之前请求的信息,用以处理当前请求,比如<code>session</code>等 </li>
</ul>
<h2 id="基于JWT（JSON-WEB-TOKEN）的Token认证机制实现"><a href="#基于JWT（JSON-WEB-TOKEN）的Token认证机制实现" class="headerlink" title="基于JWT（JSON WEB TOKEN）的Token认证机制实现"></a>基于JWT（JSON WEB TOKEN）的Token认证机制实现</h2><ul>
<li>一个JWT实际上就是一个字符串，它由三部分组成，头部、载荷与签名。 </li>
</ul>
<h3 id="头部（Header）"><a href="#头部（Header）" class="headerlink" title="头部（Header）"></a><strong>头部（Header）</strong></h3><ul>
<li>JWT还需要一个头部，头部用于描述关于该JWT的最基本的信息，例如其类型以及签名所用的算法等。这也可以被表示成一个JSON对象。 </li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"typ"</span>: <span class="string">"JWT"</span>,</div><div class="line">    <span class="attr">"alg"</span>: <span class="string">"HS256"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="载荷（Payload）"><a href="#载荷（Payload）" class="headerlink" title="载荷（Payload）"></a><strong>载荷（Payload）</strong></h3><ul>
<li>iss: 该JWT的签发者，是否使用是可选的；</li>
<li>sub: 该JWT所面向的用户,一般是用户名，是否使用是可选的；</li>
<li>aud: 接收该JWT的一方，是否使用是可选的；</li>
<li>exp(expires): 什么时候过期，这里是一个Unix时间戳，是否使用是可选的；</li>
<li>iat(issued at): 在什么时候签发的(UNIX时间)，一般是登录时间，是否使用是可选的；<br>其他还有：</li>
<li>nbf (Not Before)：如果当前时间在nbf里的时间之前，则Token不被接受；一般都会留一些余地，比如几分钟；，是否使用是可选的；</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">"iss"</span>: <span class="string">"Online JWT Builder"</span>, </div><div class="line">  <span class="attr">"iat"</span>: <span class="number">1416797419</span>, </div><div class="line">  <span class="attr">"exp"</span>: <span class="number">1448333419</span>, </div><div class="line">  <span class="attr">"aud"</span>: <span class="string">"www.example.com"</span>, </div><div class="line">  <span class="attr">"sub"</span>: <span class="string">"jrocket@example.com"</span>, </div><div class="line">  <span class="attr">"GivenName"</span>: <span class="string">"Johnny"</span>, </div><div class="line">  <span class="attr">"Surname"</span>: <span class="string">"Rocket"</span>, </div><div class="line">  <span class="attr">"Email"</span>: <span class="string">"jrocket@example.com"</span>, </div><div class="line">  <span class="attr">"Role"</span>: [ <span class="string">"Manager"</span>, <span class="string">"Project Administrator"</span> ] </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>将上面的JSON对象进行[base64编码]可以得到编码后的字符串。这个字符串我们将它称作JWT的Payload（载荷）。</strong> </li>
</ul>
<h3 id="签名（Signature）"><a href="#签名（Signature）" class="headerlink" title="签名（Signature）"></a><strong>签名（Signature）</strong></h3><ul>
<li>将头部和载荷编码后的字符串用<code>.</code>分隔（头部在前）,最后将拼接后的字符串和秘钥（secret）用头部指定的算法进行加密得到一个字符串。那么此时完整的JWT的内容就是<strong>头部+载荷+最后加密得到的字符串</strong>，中间用<code>.</code>分割</li>
</ul>
<h2 id="JJWT"><a href="#JJWT" class="headerlink" title="JJWT"></a>JJWT</h2><ul>
<li>Java实现JWT的token生成</li>
</ul>
<h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- jjwt --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="生成token"><a href="#生成token" class="headerlink" title="生成token"></a>生成token</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *  	生成token</div><div class="line"> */</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">//eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIxIiwiaWF0IjoxNTQ1NTc0ODE1LCJzdWIiOiLpmYjliqDlhbUifQ.WF0VoGSP5oH0XRsCraJ9lRjtVFRs6I0KJpkhFngpwgk</span></div><div class="line">	JwtBuilder builder = Jwts.builder()</div><div class="line">			.setId(<span class="string">"1"</span>)   <span class="comment">//用户Id</span></div><div class="line">               .setIssuedAt(<span class="keyword">new</span> Date())  <span class="comment">//用户登录的日期 </span></div><div class="line">               .setSubject(<span class="string">"陈加兵"</span>)<span class="comment">//用户名</span></div><div class="line">               .signWith(SignatureAlgorithm.HS256, <span class="string">"sercet"</span>);  <span class="comment">//指定签名的算法和秘钥（盐）  </span></div><div class="line">	String token = builder.compact();  <span class="comment">//获取生成的token</span></div><div class="line">	System.out.println(token);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="解析token"><a href="#解析token" class="headerlink" title="解析token"></a>解析token</h3><ul>
<li>解析token需要知道秘钥</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">	 * 	解析token</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</div><div class="line">		Claims claims = Jwts.parser()</div><div class="line">				.setSigningKey(<span class="string">"sercet"</span>)  <span class="comment">//设置解析的秘钥</span></div><div class="line">				.parseClaimsJws(<span class="string">"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIxIiwiaWF0IjoxNTQ1NTc0ODE1LCJzdWIiOiLpmYjliqDlhbUifQ.WF0VoGSP5oH0XRsCraJ9lRjtVFRs6I0KJpkhFngpwgk"</span>)</div><div class="line">				.getBody();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"用户Id："</span>+claims.getId());</div><div class="line">		System.out.println(<span class="string">"用户名："</span>+claims.getSubject());</div><div class="line">		System.out.println(<span class="string">"登录时间："</span>+claims.getIssuedAt());</div><div class="line">		</div><div class="line">		</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="设置过期时间"><a href="#设置过期时间" class="headerlink" title="设置过期时间"></a>设置过期时间</h3><ul>
<li>不设置过期时间默认是无时间限制的</li>
<li><code>JwtBuilder setExpiration(Date exp);</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">JwtBuilder builder = Jwts.builder()</div><div class="line">				.setId(<span class="string">"1"</span>)   <span class="comment">//用户Id</span></div><div class="line">                .setIssuedAt(<span class="keyword">new</span> Date())  <span class="comment">//用户登录的日期 </span></div><div class="line">                .setSubject(<span class="string">"陈加兵"</span>)<span class="comment">//用户名</span></div><div class="line">                .setExpiration(<span class="keyword">new</span> Date(<span class="keyword">new</span> Date().getTime()+<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>))  <span class="comment">//设置过期时间为1小时</span></div><div class="line">                .signWith(SignatureAlgorithm.HS256, <span class="string">"sercet"</span>);  <span class="comment">//指定签名的算法和秘钥（盐）</span></div></pre></td></tr></table></figure>
<h3 id="添加自定义属性"><a href="#添加自定义属性" class="headerlink" title="添加自定义属性"></a>添加自定义属性</h3><ul>
<li><code>JwtBuilder claim(String name, Object value);</code>： 直接添加自定义的属性，key-value形式</li>
<li><code>JwtBuilder addClaims(Map&lt;String, Object&gt; claims);</code>： 直接添加一个Map作为自定义的属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">	 *  	生成token</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">		JwtBuilder builder = Jwts.builder()</div><div class="line">				.setId(<span class="string">"1"</span>)   <span class="comment">//用户Id</span></div><div class="line">                .setIssuedAt(<span class="keyword">new</span> Date())  <span class="comment">//用户登录的日期 </span></div><div class="line">                .setSubject(<span class="string">"陈加兵"</span>)<span class="comment">//用户名</span></div><div class="line">                .setExpiration(<span class="keyword">new</span> Date(<span class="keyword">new</span> Date().getTime()+<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>))  <span class="comment">//设置过期时间为1小时</span></div><div class="line">                .signWith(SignatureAlgorithm.HS256, <span class="string">"sercet"</span>) <span class="comment">//指定签名的算法和秘钥（盐）</span></div><div class="line">                .claim(<span class="string">"age"</span>, <span class="number">22</span>)    <span class="comment">//自定义内容</span></div><div class="line">                .claim(<span class="string">"address"</span>, <span class="string">"江苏省"</span>); <span class="comment">//自定义内容</span></div><div class="line">		String token = builder.compact();  <span class="comment">//获取生成的token</span></div><div class="line">		System.out.println(token);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 	解析token</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</div><div class="line">		Claims claims = Jwts.parser()</div><div class="line">				.setSigningKey(<span class="string">"sercet"</span>)  <span class="comment">//设置解析的秘钥</span></div><div class="line">				.parseClaimsJws(<span class="string">"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIxIiwiaWF0IjoxNTQ1NTc1ODQzLCJzdWIiOiLpmYjliqDlhbUiLCJleHAiOjE1NDU1Nzk0NDMsImFnZSI6MjIsImFkZHJlc3MiOiLmsZ_oi4_nnIEifQ.uRhzSnsWl5IO-K6SA3zHsqGacZzkOOsFlD8lvqYDleY"</span>)</div><div class="line">				.getBody();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"用户Id："</span>+claims.getId());</div><div class="line">		System.out.println(<span class="string">"用户名："</span>+claims.getSubject());</div><div class="line">		System.out.println(<span class="string">"登录时间："</span>+claims.getIssuedAt());</div><div class="line">		System.out.println(<span class="string">"过期时间："</span>+claims.getExpiration());</div><div class="line">		System.out.println(<span class="string">"address："</span>+claims.get(<span class="string">"address"</span>));</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h2 id="在拦截器中配置"><a href="#在拦截器中配置" class="headerlink" title="在拦截器中配置"></a>在拦截器中配置</h2><h3 id="JWT工具类"><a href="#JWT工具类" class="headerlink" title="JWT工具类"></a>JWT工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</div><div class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtBuilder;</div><div class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</div><div class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</div><div class="line"><span class="keyword">import</span> lombok.Data;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * JWT的工具类</div><div class="line"> */</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"jwt.config"</span>)  <span class="comment">//读取配置文件中的配置</span></div><div class="line"><span class="meta">@Data</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtil</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> String secret;  <span class="comment">//秘钥</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">long</span> expire;  <span class="comment">//过期时间</span></div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 	生成token </div><div class="line">	 * <span class="doctag">@param</span> id  用户的Id</div><div class="line">	 * <span class="doctag">@param</span> subject  用户名</div><div class="line">	 * <span class="doctag">@param</span> role 角色，分为用户和后台管理员</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">encoder</span><span class="params">(String id,String subject,String role)</span> <span class="keyword">throws</span> Exception</span>&#123;</div><div class="line">		JwtBuilder builder = Jwts.builder()</div><div class="line">				.setId(id)   <span class="comment">//用户Id</span></div><div class="line">                .setIssuedAt(<span class="keyword">new</span> Date())  <span class="comment">//用户登录的日期 </span></div><div class="line">                .setSubject(subject)<span class="comment">//用户名</span></div><div class="line">                .setExpiration(<span class="keyword">new</span> Date(<span class="keyword">new</span> Date().getTime()+expire))  <span class="comment">//设置过期时间为1小时</span></div><div class="line">                .claim(<span class="string">"role"</span>,role)  <span class="comment">//自定义属性，指定角色</span></div><div class="line">                .signWith(SignatureAlgorithm.HS256, secret); <span class="comment">//指定签名的算法和秘钥（盐）</span></div><div class="line">                </div><div class="line">		<span class="keyword">return</span> builder.compact();  </div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 	对token进行解码</div><div class="line">	 * <span class="doctag">@param</span> token</div><div class="line">	 * <span class="doctag">@return</span> 解码后的结果集，相当于Map</div><div class="line">	 * <span class="doctag">@throws</span> Exception  如果解码失败会抛出异常</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> Claims <span class="title">decoder</span><span class="params">(String token)</span> <span class="keyword">throws</span> Exception</span>&#123;</div><div class="line">		<span class="keyword">return</span> Jwts.parser()</div><div class="line">				.setSigningKey(secret)  <span class="comment">//设置解析的秘钥</span></div><div class="line">				.parseClaimsJws(token)  <span class="comment">//解析的token</span></div><div class="line">				.getBody();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">jwt:</span> <span class="comment"># JWT的配置</span></div><div class="line"><span class="attr">  config:</span></div><div class="line"><span class="attr">    secret:</span> <span class="string">secret</span>   <span class="comment">## 秘钥</span></div><div class="line"><span class="attr">    expire:</span> <span class="number">3600000</span>  <span class="comment">## 过期时间1个小时</span></div></pre></td></tr></table></figure>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.annotation.Resource;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</div><div class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</div><div class="line"><span class="keyword">import</span> cn.tedu.auth.util.JwtUtil;</div><div class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * JWT验证token的拦截器</div><div class="line"> * 	改进： 如果没有权限，那么可以跳转到一个指定的错误页面护.......</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Resource</span></div><div class="line">	<span class="keyword">private</span> JwtUtil jwtUtil;    <span class="comment">//注入JwtUtil</span></div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		</div><div class="line">		<span class="comment">//获取请求头中的token</span></div><div class="line">		String token=request.getHeader(<span class="string">"token"</span>);</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(token)) &#123;</div><div class="line">			response.setStatus(HttpStatus.UNAUTHORIZED.value());  <span class="comment">//设置401响应信息，没有权限</span></div><div class="line">			System.err.println(<span class="string">"没有权限"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;  <span class="comment">//直接拦截，不继续进行</span></div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="comment">//如果有token，需要解码</span></div><div class="line">		Claims claims=<span class="keyword">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			System.err.println(token);</div><div class="line">			claims = jwtUtil.decoder(token);</div><div class="line">			<span class="keyword">if</span> (claims!=<span class="keyword">null</span>) &#123;</div><div class="line">				request.setAttribute(<span class="string">"claims"</span>, claims);  <span class="comment">//放置在request中，后续的接口可能还需使用</span></div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			response.setStatus(HttpStatus.UNAUTHORIZED.value());  <span class="comment">//设置401响应信息，没有权限</span></div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><ul>
<li><strong>一定要先注入拦截器类，否则拦截器内的其他对象将不能注入</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">webConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 注入拦截器，这里一定需要提前注入，否则拦截器中注入的对象将无法注入</div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="meta">@Bean</span></div><div class="line">	<span class="function"><span class="keyword">public</span> JwtInterceptor <span class="title">jwtInterceptor</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> JwtInterceptor();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</div><div class="line">		<span class="comment">// 注册自定义拦截器，添加拦截路径和排除拦截路径 ，这里直接使用上面的方法直接获取注入的拦截器即可，否则将会造成拦截器中无法注入其他的对象</span></div><div class="line">		registry.addInterceptor(jwtInterceptor()).addPathPatterns(<span class="string">"/**"</span>).excludePathPatterns(<span class="string">"/user/test"</span>)</div><div class="line">				.excludePathPatterns(<span class="string">"/user/login"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li>登录成功返回token</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> ResultInfo <span class="title">login</span><span class="params">(User user)</span><span class="keyword">throws</span> Exception</span>&#123;</div><div class="line">		ResultInfo resultInfo=<span class="keyword">new</span> ResultInfo();</div><div class="line">		User user2 = userRepository.findByName(user.getName());  </div><div class="line">		<span class="keyword">if</span> (user2==<span class="keyword">null</span>) &#123;</div><div class="line">			resultInfo.setCode(<span class="string">"-1"</span>);</div><div class="line">			resultInfo.setMessage(<span class="string">"用户名不存在"</span>);</div><div class="line">			<span class="keyword">return</span> resultInfo;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="comment">//判断密码是否正确</span></div><div class="line">		<span class="keyword">if</span> (!bCryptPasswordEncoder.matches(user.getPassword(),user2.getPassword())) &#123;</div><div class="line">			resultInfo.setCode(<span class="string">"-1"</span>);</div><div class="line">			resultInfo.setMessage(<span class="string">"密码不正确"</span>);</div><div class="line">			<span class="keyword">return</span> resultInfo;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="comment">//生成token</span></div><div class="line">		String token=JwtUtil.encoder(user2.getId()+<span class="string">""</span>, user2.getName(),<span class="string">"user"</span>);</div><div class="line">		System.err.println(token);</div><div class="line">		</div><div class="line">		Map&lt;String, Object&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">		map.put(<span class="string">"token"</span>, token);   <span class="comment">//返回token</span></div><div class="line">		map.put(<span class="string">"user"</span>, user);</div><div class="line">		resultInfo.setData(map);</div><div class="line">		resultInfo.setMessage(<span class="string">"登录成功"</span>);</div><div class="line">		<span class="keyword">return</span> resultInfo;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<ul>
<li>删除操作需要验证token是否具有指定的权限<ul>
<li>拦截器验证</li>
<li>controller中的角色验证码（后期可以使用切面将其提取出来）</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *   删除用户</div><div class="line"> * <span class="doctag">@param</span> id</div><div class="line"> * <span class="doctag">@return</span></div><div class="line"> */</div><div class="line"><span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> ResultInfo <span class="title">deleteById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span>Integer id,HttpServletRequest request) </span>&#123;</div><div class="line">	ResultInfo resultInfo=<span class="keyword">new</span> ResultInfo();</div><div class="line">	</div><div class="line">	<span class="comment">//验证角色，之后该段可以直接用切面完成</span></div><div class="line">	Claims claims = (Claims) request.getAttribute(<span class="string">"claims"</span>); <span class="comment">//获取token解析的map</span></div><div class="line">	String role=(String) claims.get(<span class="string">"role"</span>);  <span class="comment">//获取角色</span></div><div class="line">	<span class="keyword">if</span> (!<span class="string">"user"</span>.equals(role)) &#123;</div><div class="line">		resultInfo.setCode(<span class="string">"-1"</span>);</div><div class="line">		resultInfo.setMessage(<span class="string">"权限不足！"</span>);</div><div class="line">		<span class="keyword">return</span> resultInfo;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		resultInfo=userService.deleteById(id);</div><div class="line">		<span class="keyword">return</span> resultInfo;</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">		resultInfo.setCode(<span class="string">"-1"</span>);</div><div class="line">		resultInfo.setMessage(<span class="string">"异常"</span>);</div><div class="line">		<span class="keyword">return</span> resultInfo;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h2><ul>
<li>为什么用JWT？<ul>
<li>JWT只通过算法实现对Token合法性的验证，不依赖数据库，Memcached的等存储系统，因此可以做到跨服务器验证，只要密钥和算法相同，不同服务器程序生成的Token可以互相验证。</li>
</ul>
</li>
<li>JWT Token不需要持久化在任何NoSQL中，不然背离其算法验证的初心</li>
<li>在退出登录时怎样实现JWT Token失效呢？<ul>
<li>退出登录， 只要客户端端把Token丢弃就可以了，服务器端不需要废弃Token。</li>
</ul>
</li>
<li>怎样保持客户端长时间保持登录状态？<ul>
<li>服务器端提供刷新Token的接口， 客户端负责按一定的逻辑刷新服务器Token。</li>
</ul>
</li>
<li>服务器端是否应该从JWT中取出userid用于业务查询？<ul>
<li>REST API是无状态的，意味着服务器端每次请求都是独立的，即不依赖以前请求的结果，因此也不应该依赖JWT token做业务查询， 应该在请求报文中单独加个userid 字段。</li>
</ul>
</li>
<li>为了做用户水平越权的检查，可以在业务层判断传入的userid和从JWT token中解析出的userid是否一致， 有些业务可能会允许查不同用户的数据。</li>
</ul>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><ul>
<li><strong>常见验证流程:</strong><ul>
<li>用户提交用户名、密码到服务器后台</li>
<li>后台验证用户信息的正确性</li>
<li>若用户验证通过，服务器端生成Token，返回到客户端</li>
<li>客户端保存Token，再下一次请求资源时，附带上Token信息</li>
<li>服务器端（一般在拦截器中进行拦截）验证Token是否由服务器签发的</li>
<li>若Token验证通过，则返回需要的资源</li>
</ul>
</li>
</ul>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><ul>
<li><a href="https://gitee.com/chenjiabing666/auth-server.git" target="_blank" rel="external">https://gitee.com/chenjiabing666/auth-server.git</a></li>
</ul>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="https://blog.csdn.net/qq_36838191/article/details/79926196" target="_blank" rel="external">https://blog.csdn.net/qq_36838191/article/details/79926196</a></li>
<li><a href="https://www.cnblogs.com/howhy/p/7063247.html" target="_blank" rel="external">https://www.cnblogs.com/howhy/p/7063247.html</a></li>
<li><a href="https://blog.csdn.net/swl979623074/article/details/81150184" target="_blank" rel="external">https://blog.csdn.net/swl979623074/article/details/81150184</a></li>
</ul>
<h2 id="笔者有话说"><a href="#笔者有话说" class="headerlink" title="笔者有话说"></a>笔者有话说</h2><ul>
<li>最近建了一个微信交流群，提供给大家一个交流的平台，扫描下方笔者的微信二维码，备注【交流】，我会把大家拉进群</li>
</ul>
<p><img src="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg" alt=""></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/分布式/">分布式</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/分布式/">分布式</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://chenjiabing666.github.io/2018/12/25/Token认证/" data-title="Token认证 | 爱撒谎的男孩" data-tsina="5651317821" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/12/25/SpringBoot整合Spring-Data-Mongodb/" title="SpringBoot整合Spring Data Mongodb">
  <strong>上一篇：</strong><br/>
  <span>
  SpringBoot整合Spring Data Mongodb</span>
</a>
</div>


<div class="next">
<a href="/2018/12/22/springBoot整合spring-data-redis/"  title="springBoot整合spring-data-redis">
 <strong>下一篇：</strong><br/> 
 <span>springBoot整合spring-data-redis
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#认证机制"><span class="toc-number">1.</span> <span class="toc-text">认证机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的几种认证机制"><span class="toc-number">1.1.</span> <span class="toc-text">常见的几种认证机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-Basic-Auth"><span class="toc-number">1.1.1.</span> <span class="toc-text">HTTP Basic Auth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth（开放授权）"><span class="toc-number">1.1.2.</span> <span class="toc-text">OAuth（开放授权）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie-Session-认证机制"><span class="toc-number">1.1.3.</span> <span class="toc-text">Cookie/Session 认证机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于-Token-的认证机制"><span class="toc-number">1.1.4.</span> <span class="toc-text">基于 Token 的认证机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有状态服务和无状态服务"><span class="toc-number">1.1.5.</span> <span class="toc-text">有状态服务和无状态服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于JWT（JSON-WEB-TOKEN）的Token认证机制实现"><span class="toc-number">1.2.</span> <span class="toc-text">基于JWT（JSON WEB TOKEN）的Token认证机制实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#头部（Header）"><span class="toc-number">1.2.1.</span> <span class="toc-text">头部（Header）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#载荷（Payload）"><span class="toc-number">1.2.2.</span> <span class="toc-text">载荷（Payload）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#签名（Signature）"><span class="toc-number">1.2.3.</span> <span class="toc-text">签名（Signature）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JJWT"><span class="toc-number">1.3.</span> <span class="toc-text">JJWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加依赖"><span class="toc-number">1.3.1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成token"><span class="toc-number">1.3.2.</span> <span class="toc-text">生成token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解析token"><span class="toc-number">1.3.3.</span> <span class="toc-text">解析token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置过期时间"><span class="toc-number">1.3.4.</span> <span class="toc-text">设置过期时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加自定义属性"><span class="toc-number">1.3.5.</span> <span class="toc-text">添加自定义属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在拦截器中配置"><span class="toc-number">1.4.</span> <span class="toc-text">在拦截器中配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT工具类"><span class="toc-number">1.4.1.</span> <span class="toc-text">JWT工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置文件"><span class="toc-number">1.4.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器"><span class="toc-number">1.4.3.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置拦截器"><span class="toc-number">1.4.4.</span> <span class="toc-text">配置拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">1.4.5.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#相关问题"><span class="toc-number">1.5.</span> <span class="toc-text">相关问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发流程"><span class="toc-number">1.6.</span> <span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码"><span class="toc-number">1.7.</span> <span class="toc-text">源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-number">1.8.</span> <span class="toc-text">参考文章</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#笔者有话说"><span class="toc-number">1.9.</span> <span class="toc-text">笔者有话说</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hibernate/" title="Hibernate">Hibernate<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Web/" title="Java-Web">Java-Web<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/MyBatis/" title="MyBatis">MyBatis<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring/" title="Spring">Spring<sup>39</sup></a></li>
		  
		
		  
			<li><a href="/categories/SpringBoot/" title="SpringBoot">SpringBoot<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/Struts2/" title="Struts2">Struts2<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker/" title="docker">docker<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/java学习/" title="java学习">java学习<sup>35</sup></a></li>
		  
		
		  
			<li><a href="/categories/java并发编程/" title="java并发编程">java并发编程<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>19</sup></a></li>
		  
		
		  
			<li><a href="/categories/web前端/" title="web前端">web前端<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/分布式/" title="分布式">分布式<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库干货篇/" title="数据库干货篇">数据库干货篇<sup>20</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂谈/" title="杂谈">杂谈<sup>22</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>9</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>39</sup></a></li>
			
		
			
				<li><a href="/tags/杂谈/" title="杂谈">杂谈<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/java基础/" title="java基础">java基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/python爬虫/" title="python爬虫">python爬虫<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/java并发编程/" title="java并发编程">java并发编程<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/SpringBoot/" title="SpringBoot">SpringBoot<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/SQL/" title="SQL">SQL<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/分布式/" title="分布式">分布式<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Struts2/" title="Struts2">Struts2<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/java-IO编程/" title="java IO编程">java IO编程<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Redis/" title="Redis">Redis<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/MyBatis/" title="MyBatis">MyBatis<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/web前端/" title="web前端">web前端<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E4%B8%83%E7%A7%92%E7%BC%96%E7%A8%8B.jpg" target="_blank" title="微信公众号">微信公众号</a>
            
          </li>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.zhihu.com/people/xiao-ming-64-34-45/activities" target="_blank" title="本人知乎">本人知乎</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.cnblogs.com/Chenjiabing/" target="_blank" title="本人博客园">本人博客园</a>
            
          </li>
        
          <li>
            
            	<a href="https://blog.csdn.net/qq_34162294" target="_blank" title="本人CSDN">本人CSDN</a>
            
          </li>
        
          <li>
            
            	<a href="https://juejin.im/user/2506542244708072" target="_blank" title="本人掘金">本人掘金</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 欢迎关注微信公众号：码猿技术专栏 <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	 <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=14509119671822169205' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5651317821" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/chenjiabing666" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/155022807" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/https://www.zhihu.com/people/xiao-ming-64-34-45" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="不才陈某">不才陈某</a>
		
		
		</p>
		
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    $('#toc.toc-aside').css('display', 'block').addClass('fadeIn');//新加的，打开文章时自动隐藏左边的栏
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'chenjiabing666';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261577779'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s23.cnzz.com/z_stat.php%3Fid%3D1261577779' type='text/javascript'%3E%3C/script%3E"));</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

    <script type="text/javascript" src="/js/src/love.js"></script>

  </body>
  
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</html>
