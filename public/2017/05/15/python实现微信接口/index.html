
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
  
    <title>python实现微信接口 | 爱撒谎的男孩</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="不才陈某">
    

    
    <meta name="description" content="python实现微信接口(itchat)安装

sudo pip install itchat


登录

itchat.auto_login()  这种方法将会通过微信扫描二维码登录，但是这种登录的方式确实短时间的登录，并不会保留登录的状态，也就是下次登录时还是需要扫描二维码，如果加上hotReload==True,那么就会保留登录的状态，至少在后面的几次登录过程中不会再次扫描二维码，该参数生成">
<meta property="og:type" content="article">
<meta property="og:title" content="python实现微信接口">
<meta property="og:url" content="http://chenjiabing666.github.io/2017/05/15/python实现微信接口/index.html">
<meta property="og:site_name" content="爱撒谎的男孩">
<meta property="og:description" content="python实现微信接口(itchat)安装

sudo pip install itchat


登录

itchat.auto_login()  这种方法将会通过微信扫描二维码登录，但是这种登录的方式确实短时间的登录，并不会保留登录的状态，也就是下次登录时还是需要扫描二维码，如果加上hotReload==True,那么就会保留登录的状态，至少在后面的几次登录过程中不会再次扫描二维码，该参数生成">
<meta property="og:image" content="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg">
<meta property="og:updated_time" content="2020-03-13T06:06:07.045Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python实现微信接口">
<meta name="twitter:description" content="python实现微信接口(itchat)安装

sudo pip install itchat


登录

itchat.auto_login()  这种方法将会通过微信扫描二维码登录，但是这种登录的方式确实短时间的登录，并不会保留登录的状态，也就是下次登录时还是需要扫描二维码，如果加上hotReload==True,那么就会保留登录的状态，至少在后面的几次登录过程中不会再次扫描二维码，该参数生成">
<meta name="twitter:image" content="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg">

    
    <link rel="alternative" href="/atom.xml" title="爱撒谎的男孩" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/avatar.jpg" alt="爱撒谎的男孩" title="爱撒谎的男孩"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="爱撒谎的男孩">爱撒谎的男孩</a></h1>
				<h2 class="blog-motto">微信公众号：码猿技术专栏</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives/">归档</a></li>
					
						<li><a href="/about/">关于我</a></li>
					
					<li>
 					
						<form class="search" action="https://chenjiabing666.github.io/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 14509119671822170000 ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>	
			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/05/15/python实现微信接口/" title="python实现微信接口" itemprop="url">python实现微信接口</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="不才陈某" target="_blank" itemprop="author">不才陈某</a>
		
  <p class="article-time">
    <time datetime="2017-05-14T19:44:21.000Z" itemprop="datePublished"> 发表于 2017-05-15</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#python实现微信接口-itchat"><span class="toc-number">1.</span> <span class="toc-text">python实现微信接口(itchat)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#登录"><span class="toc-number">1.2.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#退出及登录完成后调用的特定的方法"><span class="toc-number">1.3.</span> <span class="toc-text">退出及登录完成后调用的特定的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回复消息"><span class="toc-number">1.4.</span> <span class="toc-text">回复消息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#send"><span class="toc-number">1.4.1.</span> <span class="toc-text">send</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-msg"><span class="toc-number">1.4.2.</span> <span class="toc-text">send_msg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-file"><span class="toc-number">1.4.3.</span> <span class="toc-text">send_file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-image"><span class="toc-number">1.4.4.</span> <span class="toc-text">send_image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-video"><span class="toc-number">1.4.5.</span> <span class="toc-text">send_video</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册消息方法"><span class="toc-number">1.5.</span> <span class="toc-text">注册消息方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注册方法"><span class="toc-number">1.5.1.</span> <span class="toc-text">注册方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#附件的下载与发送"><span class="toc-number">1.5.2.</span> <span class="toc-text">附件的下载与发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#群消息"><span class="toc-number">1.5.3.</span> <span class="toc-text">群消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册消息的优先级"><span class="toc-number">1.6.</span> <span class="toc-text">注册消息的优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息内容"><span class="toc-number">1.7.</span> <span class="toc-text">消息内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一般消息"><span class="toc-number">1.7.1.</span> <span class="toc-text">一般消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化消息"><span class="toc-number">1.7.2.</span> <span class="toc-text">初始化消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文本消息"><span class="toc-number">1.7.3.</span> <span class="toc-text">文本消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片消息"><span class="toc-number">1.7.4.</span> <span class="toc-text">图片消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视频消息"><span class="toc-number">1.7.5.</span> <span class="toc-text">视频消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地理位置消息"><span class="toc-number">1.7.6.</span> <span class="toc-text">地理位置消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#名片消息"><span class="toc-number">1.7.7.</span> <span class="toc-text">名片消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#语音消息"><span class="toc-number">1.7.8.</span> <span class="toc-text">语音消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动画表情"><span class="toc-number">1.7.9.</span> <span class="toc-text">动画表情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#普通链接或应用分享消息"><span class="toc-number">1.7.10.</span> <span class="toc-text">普通链接或应用分享消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#音乐链接消息"><span class="toc-number">1.7.11.</span> <span class="toc-text">音乐链接消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#群消息-1"><span class="toc-number">1.7.12.</span> <span class="toc-text">群消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#红包消息"><span class="toc-number">1.7.13.</span> <span class="toc-text">红包消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统消息"><span class="toc-number">1.7.14.</span> <span class="toc-text">系统消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#账号类型"><span class="toc-number">1.8.</span> <span class="toc-text">账号类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#好友"><span class="toc-number">1.8.1.</span> <span class="toc-text">好友</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get-friends"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">get_friends</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#search-friends"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">search_friends</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update-friend"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">update_friend</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#公众号"><span class="toc-number">1.8.2.</span> <span class="toc-text">公众号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get-mps"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">get_mps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#search-mps"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">search_mps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#群聊"><span class="toc-number">1.8.3.</span> <span class="toc-text">群聊</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#方法汇总"><span class="toc-number">1.9.</span> <span class="toc-text">方法汇总</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例"><span class="toc-number">1.10.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码"><span class="toc-number">1.10.1.</span> <span class="toc-text">代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-number">1.11.</span> <span class="toc-text">参考文章</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#笔者有话说"><span class="toc-number">1.12.</span> <span class="toc-text">笔者有话说</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="python实现微信接口-itchat"><a href="#python实现微信接口-itchat" class="headerlink" title="python实现微信接口(itchat)"></a>python实现微信接口(itchat)</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote>
<ul>
<li><code>sudo pip install itchat</code></li>
</ul>
</blockquote>
<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><blockquote>
<ul>
<li><code>itchat.auto_login()</code>  这种方法将会通过微信扫描二维码登录，但是这种登录的方式确实短时间的登录，并不会保留登录的状态，也就是下次登录时还是需要扫描二维码，如果加上<code>hotReload==True</code>,那么就会保留登录的状态，至少在后面的几次登录过程中不会再次扫描二维码，该参数生成一个静态文件<code>itchat.pkl</code>用于存储登录状态</li>
</ul>
</blockquote>
<h2 id="退出及登录完成后调用的特定的方法"><a href="#退出及登录完成后调用的特定的方法" class="headerlink" title="退出及登录完成后调用的特定的方法"></a>退出及登录完成后调用的特定的方法</h2><blockquote>
<p><em>这里主要使用的是灰调函数的方法,登录完成后的方法需要赋值在 <code>loginCallback</code>中退出后的方法,需要赋值在 <code>exitCallback</code>中.若不设置 <code>loginCallback</code>的值, 将会自动删除二维码图片并清空命令行显示.</em></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> itchat, time</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">lc</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"Finash Login!"</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ec</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"exit"</span>)</div><div class="line"></div><div class="line">itchat.auto_login(loginCallback=lc, exitCallback=ec)</div><div class="line">time.sleep()</div><div class="line">itchat.logout()    <span class="comment">#强制退出登录</span></div></pre></td></tr></table></figure>
<h2 id="回复消息"><a href="#回复消息" class="headerlink" title="回复消息"></a>回复消息</h2><h3 id="send"><a href="#send" class="headerlink" title="send"></a>send</h3><blockquote>
<ul>
<li><code>send(msg=&quot;Text Message&quot;, toUserName=None)</code></li>
</ul>
<blockquote>
<p><strong>参数：</strong></p>
<ul>
<li><code>msg</code> : 文本消息内容</li>
<li><code>@fil@path_to_file</code> : 发送文件</li>
<li><code>@img@path_to_img</code> : 发送图片</li>
<li><code>@vid@path_to_video</code> : 发送视频</li>
<li><code>toUserName</code> : 发送对象, 如果留空, 将发送给自己.</li>
</ul>
</blockquote>
<p><strong>返回值</strong></p>
<blockquote>
<ul>
<li><code>True</code> or <code>False</code></li>
</ul>
<p><strong>实例代码</strong></p>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding-utf-8</span></div><div class="line"><span class="keyword">import</span> itchat</div><div class="line">itchat.auto_login()</div><div class="line">itchat.send(<span class="string">"Hello World!"</span>)</div><div class="line">ithcat.send(<span class="string">"@fil@%s"</span> % <span class="string">'/tmp/test.text'</span>)</div><div class="line">ithcat.send(<span class="string">"@img@%s"</span> % <span class="string">'/tmp/test.png'</span>)</div><div class="line">ithcat.send(<span class="string">"@vid@%s"</span> % <span class="string">'/tmp/test.mkv'</span>)</div></pre></td></tr></table></figure>
<h3 id="send-msg"><a href="#send-msg" class="headerlink" title="send_msg"></a>send_msg</h3><blockquote>
<ul>
<li><code>send_msg(msg=&#39;Text Message&#39;, toUserName=None)</code>,其中的的<code>msg</code>是要发送的文本，<code>toUserName</code>是发送对象, 如果留空, 将发送给自己，返回值为<code>True</code>或者<code>False</code></li>
</ul>
<p><strong>实例代码</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itchat</div><div class="line">itchat.auto_login()</div><div class="line">itchat.send_msg(<span class="string">"hello world."</span>)</div></pre></td></tr></table></figure>
<h3 id="send-file"><a href="#send-file" class="headerlink" title="send_file"></a>send_file</h3><blockquote>
<ul>
<li><code>send_file(fileDir, toUserName=None)</code>  <code>fileDir</code>是文件路径, 当文件不存在时, 将打印无此文件的提醒，返回值为<code>True</code>或者<code>False</code></li>
</ul>
<p><strong>实例代码</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mport itchat</div><div class="line"></div><div class="line">itchat.auto_login()</div><div class="line">itchat.send_file(<span class="string">"/tmp/test.txt"</span>)</div></pre></td></tr></table></figure>
<h3 id="send-image"><a href="#send-image" class="headerlink" title="send_image"></a>send_image</h3><blockquote>
<ul>
<li><code>send_image(fileDir, toUserName=None)</code>  参数同上</li>
</ul>
<p><strong>实例代码</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> itchat</div><div class="line"></div><div class="line">itchat.auto_login()</div><div class="line">itchat.send_img(<span class="string">"/tmp/test.txt"</span>)</div></pre></td></tr></table></figure>
<h3 id="send-video"><a href="#send-video" class="headerlink" title="send_video"></a>send_video</h3><blockquote>
<ul>
<li><code>send_video(fileDir, toUserName=None)</code> 参数同上</li>
</ul>
<p><strong>实例代码</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itchat</div><div class="line"></div><div class="line">itchat.auto_login()</div><div class="line">itchat.send_video(<span class="string">"/tmp/test.txt"</span>)</div></pre></td></tr></table></figure>
<h2 id="注册消息方法"><a href="#注册消息方法" class="headerlink" title="注册消息方法"></a>注册消息方法</h2><blockquote>
<p><em><code>itchat</code> 将根据接受到的消息类型寻找对应的已注册的方法.</em><br><em>如果一个消息类型没有对应的注册方法, 该消息将会被舍弃.</em><br><em>在运行过程中也可以动态注册方法, 注册方式与结果不变.</em></p>
</blockquote>
<h3 id="注册方法"><a href="#注册方法" class="headerlink" title="注册方法"></a>注册方法</h3><blockquote>
<ul>
<li>不带具体对象注册, 将注册为普通消息的回复方法.</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itchat</div><div class="line"><span class="keyword">from</span> itchat.content <span class="keyword">import</span> *</div><div class="line"><span class="meta">@itchat.msg_register(TEXT)   #这里的TEXT表示如果有人发送文本消息，那么就会调用下面的方法</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">simple_reply</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="comment">#这个是向发送者发送消息</span></div><div class="line">    itchat.send_msg(<span class="string">'已经收到了文本消息，消息内容为%s'</span>%msg[<span class="string">'Text'</span>],toUserName=msg[<span class="string">'FromUserName'</span>])</div><div class="line">    <span class="keyword">return</span> <span class="string">"T reveived: %s"</span> % msg[<span class="string">"Text"</span>]     <span class="comment">#返回的给对方的消息，msg["Text"]表示消息的内容</span></div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>带对象参数注册, 对应消息对象将调用该方法，其中<code>isFriendChat</code>表示好友之间，<code>isGroupChat</code>表示群聊，<code>isMapChat</code>表示公众号</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itchat</div><div class="line"><span class="keyword">from</span> itchat.content <span class="keyword">import</span> *</div><div class="line"></div><div class="line"><span class="meta">@itchat.msg_register(TEXT, isFriendChat=True, isGroupChat=True,isMpChat=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_reply</span><span class="params">(msg)</span>:</span></div><div class="line">    msg.user.send(<span class="string">"%s : %s"</span> % (mst.type, msg.text))</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>消息类型<br><em>向注册方法传入的 <code>msg</code> 包含微信返回的字典的所有内容.<code>itchat</code> 增加 <code>Text</code>, <code>Type</code>(也就是参数) 键值, 方便操作.</em><br><strong><code>itcaht.content</code>中包含所有的消息类型参数, 如下表</strong></li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>l类型</th>
<th>Text 键值</th>
</tr>
</thead>
<tbody>
<tr>
<td>TEXT</td>
<td>文本</td>
<td>文本内容(文字消息)</td>
</tr>
<tr>
<td>MAP</td>
<td>地图</td>
<td>位置文本(位置分享)</td>
</tr>
<tr>
<td>CARD</td>
<td>名片</td>
<td>推荐人字典(推荐人的名片)</td>
</tr>
<tr>
<td>SHARING</td>
<td>分享</td>
<td>分享名称(分享的音乐或者文章等)</td>
</tr>
<tr>
<td>PICTURE        下载方法</td>
<td></td>
<td>图片/表情</td>
</tr>
<tr>
<td>RECORDING</td>
<td>语音</td>
<td>下载方法</td>
</tr>
<tr>
<td>ATTACHMENT</td>
<td>附件</td>
<td>下载方法</td>
</tr>
<tr>
<td>VIDEO</td>
<td>小视频</td>
<td>下载方法</td>
</tr>
<tr>
<td>FRIENDS</td>
<td>好友邀请</td>
<td>添加好友所需参数</td>
</tr>
<tr>
<td>SYSTEM</td>
<td>系统消息</td>
<td>更新内容的用户或群聊的UserName组成的列表</td>
</tr>
<tr>
<td>NOTE</td>
<td>通知</td>
<td>通知文本(消息撤回等)</td>
</tr>
</tbody>
</table>
<h3 id="附件的下载与发送"><a href="#附件的下载与发送" class="headerlink" title="附件的下载与发送"></a>附件的下载与发送</h3><blockquote>
<p><em><code>itchat</code> 的附件下载方法存储在 <code>msg</code> 的 <code>Text</code> 键中.</em><br><em>发送的文件名(图片给出的默认文件名), 都存储在 <code>msg</code> 的 <code>FileName</code> 键中.</em><br><em>下载方法, 接受一个可用的位置参数(包括文件名), 并将文件响应的存储.</em><br><strong><em>注意：下载的文件存储在指定的文件中，直接将路径与<code>FileName</code>连接即可，如<code>msg[&quot;Text&quot;](&#39;/tmp/weichat&#39;+msg[&#39;FileName&#39;])</code></em></strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@itchat.msg_register([PICTURE, RECORDING, ATTACHMENT, VIDEO])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_files</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="comment">#msg.download(msg['FileName'])   #这个同样是下载文件的方式</span></div><div class="line">    msg[<span class="string">'Text'</span>](msg[<span class="string">'FileName'</span>])      <span class="comment">#下载文件</span></div><div class="line">    <span class="comment">#将下载的文件发送给发送者</span></div><div class="line">    itchat.send(<span class="string">'@%s@%s'</span> % (<span class="string">'img'</span> <span class="keyword">if</span> msg[<span class="string">'Type'</span>] == <span class="string">'Picture'</span> <span class="keyword">else</span> <span class="string">'fil'</span>, msg[<span class="string">"FileName"</span>]), msg[<span class="string">"FromUserName"</span>])</div></pre></td></tr></table></figure>
<h3 id="群消息"><a href="#群消息" class="headerlink" title="群消息"></a>群消息</h3><blockquote>
<p><em>增加了三个键值，如下：</em></p>
<blockquote>
<ul>
<li><code>isAt</code> 判断是否 @ 本号</li>
<li><code>ActualNickName</code> : 实际 <code>NickName</code>(昵称)</li>
<li><code>Content</code> : 实际 <code>Content</code></li>
</ul>
</blockquote>
<p><strong>测试程序</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itcaht</div><div class="line"><span class="keyword">from</span> itchat.content <span class="keyword">import</span> TEXT</div><div class="line"></div><div class="line"><span class="meta">@itchat.msg_register(TEXT, isGroupChat=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_reply</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="keyword">if</span>(msg.isAt):    <span class="comment">#判断是否有人@自己</span></div><div class="line">    <span class="comment">#如果有人@自己，就发一个消息告诉对方我已经收到了信息</span></div><div class="line">    itchat.send_msg(<span class="string">"我已经收到了来自&#123;0&#125;的消息，实际内容为&#123;1&#125;"</span>.format(msg[<span class="string">'ActualNickName'</span>],msg[<span class="string">'Text'</span>]),toUserName=msg[<span class="string">'FromUserName'</span>])</div><div class="line"></div><div class="line">itchat.auto_login()</div><div class="line">itchat.run()</div></pre></td></tr></table></figure>
<h2 id="注册消息的优先级"><a href="#注册消息的优先级" class="headerlink" title="注册消息的优先级"></a>注册消息的优先级</h2><blockquote>
<p><em>总的来说就是后面注册同种类型的消息会覆盖之前注册的消息，详情见文档<a href="https://itchat.readthedocs.io/zh/latest/" target="_blank" rel="external">https://itchat.readthedocs.io/zh/latest/</a></em></p>
</blockquote>
<h2 id="消息内容"><a href="#消息内容" class="headerlink" title="消息内容"></a>消息内容</h2><blockquote>
<p><strong>注意：所有的消息内容都是可以用键值对来访问的，如<code>msg[&quot;FromUserName]</code>就是查看发送者，<code>itchat.search_friends(userName=msg[&#39;FromUserName&#39;])[&#39;NickName&#39;]</code>查看的是当发送者昵称</strong></p>
<h3 id="一般消息"><a href="#一般消息" class="headerlink" title="一般消息"></a>一般消息</h3><p><em>一般的消息都遵循以下的内容：</em></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"FromUserName"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"ToUserName"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"Content"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"StatusNotifyUserName"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"ImgWidth"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"PlayLength"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"RecommendInfo"</span>: &#123;&#125;,</div><div class="line">    <span class="string">"StatusNotifyCode"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"NewMsgId"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"Status"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"VoiceLength"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"ForwardFlag"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"AppMsgType"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"Ticket"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"AppInfo"</span>: &#123;&#125;,</div><div class="line">    <span class="string">"Url"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"ImgStatus"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"MsgType"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"ImgHeight"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"MediaId"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"MsgId"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"FileName"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"HasProductId"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"FileSize"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"CreateTime"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"SubMsgType"</span>: <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="初始化消息"><a href="#初始化消息" class="headerlink" title="初始化消息"></a>初始化消息</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">MsgType: 51</div><div class="line">   FromUserName: 自己ID</div><div class="line">   ToUserName: 自己ID</div><div class="line">   StatusNotifyUserName: 最近联系的联系人ID</div><div class="line">   Content:</div><div class="line">       &lt;msg&gt;</div><div class="line">           &lt;op id='4'&gt;</div><div class="line">               &lt;username&gt;</div><div class="line">                   # 最近联系的联系人</div><div class="line">                   filehelper,xxx@chatroom,wxid_xxx,xxx,...</div><div class="line">               &lt;/username&gt;</div><div class="line">               &lt;unreadchatlist&gt;</div><div class="line">                   &lt;chat&gt;</div><div class="line">                       &lt;username&gt;</div><div class="line">                       # 朋友圈</div><div class="line">                           MomentsUnreadMsgStatus</div><div class="line">                       &lt;/username&gt;</div><div class="line">                       &lt;lastreadtime&gt;</div><div class="line">                           1454502365</div><div class="line">                       &lt;/lastreadtime&gt;</div><div class="line">                   &lt;/chat&gt;</div><div class="line">               &lt;/unreadchatlist&gt;</div><div class="line">               &lt;unreadfunctionlist&gt;</div><div class="line">               # 未读的功能账号消息，群发助手，漂流瓶等</div><div class="line">               &lt;/unreadfunctionlist&gt;</div><div class="line">           &lt;/op&gt;</div><div class="line">       &lt;/msg&gt;</div></pre></td></tr></table></figure>
<h3 id="文本消息"><a href="#文本消息" class="headerlink" title="文本消息"></a>文本消息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MsgType: <span class="number">1</span></div><div class="line">    FromUserName: 发送方ID</div><div class="line">    ToUserName: 接收方ID</div><div class="line">    Content: 消息内容</div></pre></td></tr></table></figure>
<h3 id="图片消息"><a href="#图片消息" class="headerlink" title="图片消息"></a>图片消息</h3><blockquote>
<p><strong><code>itchat</code> 增加了 <code>Text</code> 键, 键值为 下载该图片的方法.</strong></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">MsgType: 3</div><div class="line">    FromUserName: 发送方ID</div><div class="line">    ToUserName: 接收方ID</div><div class="line">    MsgId: 用于获取图片，用于表示每一条消息</div><div class="line">    Content:</div><div class="line">        &lt;msg&gt;</div><div class="line">            &lt;img length="6503" hdlength="0" /&gt;</div><div class="line">            &lt;commenturl&gt;&lt;/commenturl&gt;</div><div class="line">        &lt;/msg&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>拓展：如果想要得到<code>Content</code>中的具体内容可以使用正则表达式匹配出来</strong></p>
</blockquote>
<h3 id="视频消息"><a href="#视频消息" class="headerlink" title="视频消息"></a>视频消息</h3><blockquote>
<p><em>**<code>itchat</code> 增加了 <code>Text</code> 键, 键值为 下载该视频的方法.</em></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">MsgType: 62</div><div class="line">FromUserName: 发送方ID</div><div class="line">ToUserName: 接收方ID</div><div class="line">MsgId: 用于获取小视频</div><div class="line">Content:</div><div class="line">    &lt;msg&gt;</div><div class="line">        &lt;img length="6503" hdlength="0" /&gt;</div><div class="line">        &lt;commenturl&gt;&lt;/commenturl&gt;</div><div class="line">    &lt;/msg&gt;</div></pre></td></tr></table></figure>
<h3 id="地理位置消息"><a href="#地理位置消息" class="headerlink" title="地理位置消息"></a>地理位置消息</h3><blockquote>
<p><strong><code>itchat</code> 增加了 <code>Text</code> 键, 键值为 该地点的文本形式.</strong></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">MsgType: 1</div><div class="line">    FromUserName: 发送方ID</div><div class="line">    ToUserName: 接收方ID</div><div class="line">    Content: http://weixin.qq.com/cgi-bin/redirectforward?args=xxx</div><div class="line">    </div><div class="line">    OriContent:&lt;?xml version="1.0"?&gt;</div><div class="line">&lt;msg&gt;</div><div class="line">	&lt;location x="34.195278" y="117.177803" scale="16" label="江苏省徐州市铜山区新区海河路" maptype="0" poiname="江苏师范大学大学生公寓园区" /&gt;</div><div class="line">&lt;/msg&gt;</div></pre></td></tr></table></figure>
<h3 id="名片消息"><a href="#名片消息" class="headerlink" title="名片消息"></a>名片消息</h3><blockquote>
<p><strong><code>itchat</code> 增加了<code>Text</code> 键, 键值为 该调用 <code>add_friend</code> 需要的属性.</strong></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">MsgType: 42</div><div class="line">   FromUserName: 发送方ID</div><div class="line">   ToUserName: 接收方ID</div><div class="line">   Content:</div><div class="line">       &lt;?xml version="1.0"?&gt;</div><div class="line">       &lt;msg bigheadimgurl="" smallheadimgurl="" username="" nickname=""  shortpy="" alias="" imagestatus="3" scene="17" province="" city="" sign="" sex="1" certflag="0" certinfo="" brandIconUrl="" brandHomeUrl="" brandSubscriptConfigUrl="" brandFlags="0" regionCode="" /&gt;</div><div class="line"></div><div class="line">   RecommendInfo:</div><div class="line">       &#123;</div><div class="line">           "UserName": "xxx", # ID，这里的是昵称</div><div class="line">           "Province": "xxx",   </div><div class="line">           "City": "xxx",    </div><div class="line">           "Scene": 17, </div><div class="line">           "QQNum": 0, </div><div class="line">           "Content": "", </div><div class="line">           "Alias": "xxx", # 微信号</div><div class="line">           "OpCode": 0, </div><div class="line">           "Signature": "", </div><div class="line">           "Ticket": "", </div><div class="line">           "Sex": 0, # 1:男, 2:女</div><div class="line">           "NickName": "xxx", # 昵称</div><div class="line">           "AttrStatus": 4293221, </div><div class="line">           "VerifyFlag": 0</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>下面是添加好友的测试代码</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@itchat.msg_register(itchat.content.CARD,isFriendChat=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">simply</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'Text'</span>]</div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'Content'</span>]</div><div class="line">    itchat.add_friend(userName=msg[<span class="string">'Text'</span>][<span class="string">'UserName'</span>])  <span class="comment">#添加推荐的好友</span></div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'RecommendInfo'</span>]</div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'RecommendInfo'</span>][<span class="string">'UserName'</span>]</div></pre></td></tr></table></figure>
<h3 id="语音消息"><a href="#语音消息" class="headerlink" title="语音消息"></a>语音消息</h3><blockquote>
<p><em>*<code>itchat</code>增加了<code>Text</code>键,键值为下载该语音文件的方法,下载下来的是<code>MP3</code>的格式</em></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">MsgType: 34</div><div class="line">    FromUserName: 发送方ID</div><div class="line">    ToUserName: 接收方ID</div><div class="line">    MsgId: 用于获取语音</div><div class="line">    Content:</div><div class="line">        &lt;msg&gt;</div><div class="line">            &lt;voicemsg endflag="1" cancelflag="0" forwardflag="0" voiceformat="4" voicelength="1580" length="2026" bufid="216825389722501519" clientmsgid="49efec63a9774a65a932a4e5fcd4e923filehelper174_1454602489" fromusername="" /&gt;</div><div class="line">        &lt;/msg&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>下载方法：<code>msg[&#39;Text&#39;](msg[&#39;FileName&#39;])</code></strong></p>
</blockquote>
<h3 id="动画表情"><a href="#动画表情" class="headerlink" title="动画表情"></a>动画表情</h3><blockquote>
<p><strong><code>itchat</code>添加了<code>Text</code>键，键值为下载该图片表情的方法。</strong><br><strong>注意：本人亲测对于一些微信商店提供的表情是不能下载成功的,这里的自带的表情<code>emoji</code>是属于<code>TEXT</code>类别的，因此如果将其注册为<code>PICTURE</code>消息类型的话是不可以监测到的</strong></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MsgType: 47</div><div class="line">  FromUserName: 发送方ID</div><div class="line">  ToUserName: 接收方ID</div><div class="line">  Content:</div><div class="line">      &lt;msg&gt;</div><div class="line">          &lt;emoji fromusername = "" tousername = "" type="2" idbuffer="media:0_0" md5="e68363487d8f0519c4e1047de403b2e7" len = "86235" productid="com.tencent.xin.emoticon.bilibili" androidmd5="e68363487d8f0519c4e1047de403b2e7" androidlen="86235" s60v3md5 = "e68363487d8f0519c4e1047de403b2e7" s60v3len="86235" s60v5md5 = "e68363487d8f0519c4e1047de403b2e7" s60v5len="86235" cdnurl = "http://emoji.qpic.cn/wx_emoji/eFygWtxcoMF8M0oCCsksMA0gplXAFQNpiaqsmOicbXl1OC4Tyx18SGsQ/" designerid = "" thumburl = "http://mmbiz.qpic.cn/mmemoticon/dx4Y70y9XctRJf6tKsy7FwWosxd4DAtItSfhKS0Czr56A70p8U5O8g/0" encrypturl = "http://emoji.qpic.cn/wx_emoji/UyYVK8GMlq5VnJ56a4GkKHAiaC266Y0me0KtW6JN2FAZcXiaFKccRevA/" aeskey= "a911cc2ec96ddb781b5ca85d24143642" &gt;&lt;/emoji&gt; </div><div class="line">          &lt;gameext type="0" content="0" &gt;&lt;/gameext&gt;</div><div class="line">      &lt;/msg&gt;</div></pre></td></tr></table></figure>
<h3 id="普通链接或应用分享消息"><a href="#普通链接或应用分享消息" class="headerlink" title="普通链接或应用分享消息"></a>普通链接或应用分享消息</h3><blockquote>
<p><strong>主要针对的是分享的文章等等</strong></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">MsgType: 49</div><div class="line">AppMsgType: 5</div><div class="line">FromUserName: 发送方ID</div><div class="line">ToUserName: 接收方ID</div><div class="line">Url: 链接地址</div><div class="line">FileName: 链接标题</div><div class="line">Content:</div><div class="line">    &lt;msg&gt;</div><div class="line">        &lt;appmsg appid=""  sdkver="0"&gt;</div><div class="line">            &lt;title&gt;&lt;/title&gt;</div><div class="line">            &lt;des&gt;&lt;/des&gt;</div><div class="line">            &lt;type&gt;5&lt;/type&gt;</div><div class="line">            &lt;content&gt;&lt;/content&gt;</div><div class="line">            &lt;url&gt;&lt;/url&gt;</div><div class="line">            &lt;thumburl&gt;&lt;/thumburl&gt;</div><div class="line">            ...</div><div class="line">        &lt;/appmsg&gt;</div><div class="line">        &lt;appinfo&gt;</div><div class="line">            &lt;version&gt;&lt;/version&gt;</div><div class="line">            &lt;appname&gt;&lt;/appname&gt;</div><div class="line">        &lt;/appinfo&gt;</div><div class="line">    &lt;/msg&gt;</div></pre></td></tr></table></figure>
<h3 id="音乐链接消息"><a href="#音乐链接消息" class="headerlink" title="音乐链接消息"></a>音乐链接消息</h3><blockquote>
<p><strong>主要针对的是音乐</strong></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">MsgType: 49</div><div class="line">    AppMsgType: 3</div><div class="line">    FromUserName: 发送方ID</div><div class="line">    ToUserName: 接收方ID</div><div class="line">    Url: 链接地址</div><div class="line">    FileName: 音乐名</div><div class="line"></div><div class="line">    AppInfo: # 分享链接的应用</div><div class="line">        &#123;</div><div class="line">            Type: 0, </div><div class="line">            AppID: wx485a97c844086dc9</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    Content:</div><div class="line">        &lt;msg&gt;</div><div class="line">            &lt;appmsg appid="wx485a97c844086dc9"  sdkver="0"&gt;</div><div class="line">                &lt;title&gt;&lt;/title&gt;</div><div class="line">                &lt;des&gt;&lt;/des&gt;</div><div class="line">                &lt;action&gt;&lt;/action&gt;</div><div class="line">                &lt;type&gt;3&lt;/type&gt;</div><div class="line">                &lt;showtype&gt;0&lt;/showtype&gt;</div><div class="line">                &lt;mediatagname&gt;&lt;/mediatagname&gt;</div><div class="line">                &lt;messageext&gt;&lt;/messageext&gt;</div><div class="line">                &lt;messageaction&gt;&lt;/messageaction&gt;</div><div class="line">                &lt;content&gt;&lt;/content&gt;</div><div class="line">                &lt;contentattr&gt;0&lt;/contentattr&gt;</div><div class="line">                &lt;url&gt;&lt;/url&gt;</div><div class="line">                &lt;lowurl&gt;&lt;/lowurl&gt;</div><div class="line">                &lt;dataurl&gt;</div><div class="line">                    http://ws.stream.qqmusic.qq.com/C100003i9hMt1bgui0.m4a?vkey=6867EF99F3684&amp;amp;guid=ffffffffc104ea2964a111cf3ff3edaf&amp;amp;fromtag=46</div><div class="line">                &lt;/dataurl&gt;</div><div class="line">                &lt;lowdataurl&gt;</div><div class="line">                    http://ws.stream.qqmusic.qq.com/C100003i9hMt1bgui0.m4a?vkey=6867EF99F3684&amp;amp;guid=ffffffffc104ea2964a111cf3ff3edaf&amp;amp;fromtag=46</div><div class="line">                &lt;/lowdataurl&gt;</div><div class="line">                &lt;appattach&gt;</div><div class="line">                    &lt;totallen&gt;0&lt;/totallen&gt;</div><div class="line">                    &lt;attachid&gt;&lt;/attachid&gt;</div><div class="line">                    &lt;emoticonmd5&gt;&lt;/emoticonmd5&gt;</div><div class="line">                    &lt;fileext&gt;&lt;/fileext&gt;</div><div class="line">                &lt;/appattach&gt;</div><div class="line">                &lt;extinfo&gt;&lt;/extinfo&gt;</div><div class="line">                &lt;sourceusername&gt;&lt;/sourceusername&gt;</div><div class="line">                &lt;sourcedisplayname&gt;&lt;/sourcedisplayname&gt;</div><div class="line">                &lt;commenturl&gt;&lt;/commenturl&gt;</div><div class="line">                &lt;thumburl&gt;</div><div class="line">                    http://imgcache.qq.com/music/photo/album/63/180_albumpic_143163_0.jpg</div><div class="line">                &lt;/thumburl&gt;</div><div class="line">                &lt;md5&gt;&lt;/md5&gt;</div><div class="line">            &lt;/appmsg&gt;</div><div class="line">            &lt;fromusername&gt;&lt;/fromusername&gt;</div><div class="line">            &lt;scene&gt;0&lt;/scene&gt;</div><div class="line">            &lt;appinfo&gt;</div><div class="line">                &lt;version&gt;29&lt;/version&gt;</div><div class="line">                &lt;appname&gt;摇一摇搜歌&lt;/appname&gt;</div><div class="line">            &lt;/appinfo&gt;</div><div class="line">            &lt;commenturl&gt;&lt;/commenturl&gt;</div><div class="line">        &lt;/msg&gt;</div></pre></td></tr></table></figure>
<h3 id="群消息-1"><a href="#群消息-1" class="headerlink" title="群消息"></a>群消息</h3><blockquote>
<p><em><code>itchat</code> 增加了三个群聊相关的键值:</em></p>
<blockquote>
<ul>
<li><code>isAt</code> : 判断是否 @ 本号</li>
<li><code>ActualNickName</code> : 实际 <code>NickName</code></li>
<li><code>Content</code> : 实际 <code>Content</code></li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">MsgType: <span class="number">1</span></div><div class="line">FromUserName: @@xxx</div><div class="line">ToUserName: @xxx</div><div class="line">Content:</div><div class="line"><span class="meta">    @xxx:&lt;br/&gt;xxx</span></div></pre></td></tr></table></figure>
<h3 id="红包消息"><a href="#红包消息" class="headerlink" title="红包消息"></a>红包消息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">MsgType: <span class="number">49</span></div><div class="line">   AppMsgType: <span class="number">2001</span></div><div class="line">   FromUserName: 发送方ID</div><div class="line">   ToUserName: 接收方ID</div><div class="line">   Content: 未知</div></pre></td></tr></table></figure>
<h3 id="系统消息"><a href="#系统消息" class="headerlink" title="系统消息"></a>系统消息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MsgType: <span class="number">10000</span></div><div class="line">   FromUserName: 发送方ID</div><div class="line">   ToUserName: 自己ID</div><div class="line">   Content:</div><div class="line">       <span class="string">"你已添加了 xxx ，现在可以开始聊天了。"</span></div><div class="line">       <span class="string">"如果陌生人主动添加你为朋友，请谨慎核实对方身份。"</span></div><div class="line">       <span class="string">"收到红包，请在手机上查看"</span></div></pre></td></tr></table></figure>
<h2 id="账号类型"><a href="#账号类型" class="headerlink" title="账号类型"></a>账号类型</h2><blockquote>
<p><strong><code>tchat</code> 为三种账号都提供了 整体获取方法与搜索方法.</strong></p>
</blockquote>
<h3 id="好友"><a href="#好友" class="headerlink" title="好友"></a>好友</h3><h4 id="get-friends"><a href="#get-friends" class="headerlink" title="get_friends"></a>get_friends</h4><blockquote>
<ul>
<li><code>itchat.get_friends()</code>  返回完整的好友列表</li>
</ul>
<blockquote>
<ul>
<li>每个好友为一个字典, 其中第一项为本人的账号信息;</li>
<li>传入<code>update=True</code>, 将更新好友列表并返回, <code>get_friends(update=True)</code></li>
</ul>
</blockquote>
</blockquote>
<h4 id="search-friends"><a href="#search-friends" class="headerlink" title="search_friends"></a>search_friends</h4><blockquote>
<ul>
<li>itchat.get_friends()   好友搜索，有以下四种方式</li>
</ul>
<blockquote>
<ul>
<li>仅获取自己的用户信息</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取自己的用户信息，返回自己的属性字典</span></div><div class="line">itchat.search_friends()</div></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<ul>
<li>获取特定 <code>UserName</code> 的用户信息</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># 获取特定UserName的用户信息</span></div><div class="line">itchat.search_friends(userName=<span class="string">'@abcdefg1234567'</span>) </div><div class="line"></div><div class="line"><span class="comment">## 获取发送信息的好友的详细信息</span></div><div class="line"><span class="meta">@itchat.msg_register(itchat.content.TEXT,isFriendChat=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">reply</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'FromUserName'</span>]</div><div class="line">    <span class="keyword">print</span> itchat.search_friends(userName=msg[<span class="string">'FromUserName'</span>])   <span class="comment">#详细信息</span></div><div class="line">    <span class="keyword">print</span> itchat.search_friends(userName=msg[<span class="string">'FromUserName'</span>])[<span class="string">'NickName'</span>]   <span class="comment">#获取昵称</span></div></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<ul>
<li>获取备注,微信号, 昵称中的任何一项等于<code>name</code>键值的用户. (可以与下一项配置使用.)</li>
</ul>
</blockquote>
<p><strong>比如在我的微信中有一个备注为<code>autolife</code>的人，我可以使用这个方法搜索出详细的信息</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取任何一项等于name键值的用户</span></div><div class="line">itchat.search_friends(name=<span class="string">'autolife'</span>)</div></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<ul>
<li>获取备注,微信号, 昵称分别等于相应键值的用户. (可以与上一项配置使用.)</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取分别对应相应键值的用户</span></div><div class="line">itchat.search_friends(wechatAccount=<span class="string">'littlecodersh'</span>)</div><div class="line"><span class="comment"># 三、四项功能可以一同使用</span></div><div class="line">itchat.search_friends(name=<span class="string">'LittleCoder机器人'</span>, wechatAccount=<span class="string">'littlecodersh'</span>)</div></pre></td></tr></table></figure>
<h4 id="update-friend"><a href="#update-friend" class="headerlink" title="update_friend"></a>update_friend</h4><blockquote>
<p><em>主要用于好友更新</em></p>
<blockquote>
<ul>
<li>特定用户: 传入用户<code>UserName</code>, 返回指定用户的最新信息.</li>
<li>用户列表: 传入 <code>UserName</code> 组成的列表, 返回用户最新信息组成的列表</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">memberList = itchat.update_friend(<span class="string">'@abcdefg1234567'</span>)</div></pre></td></tr></table></figure>
<h3 id="公众号"><a href="#公众号" class="headerlink" title="公众号"></a>公众号</h3><h4 id="get-mps"><a href="#get-mps" class="headerlink" title="get_mps"></a>get_mps</h4><blockquote>
<p><strong> 将返回完整的工作号列表</strong></p>
<blockquote>
<ul>
<li>每个公众号为一个字典,</li>
<li>传入 <code>update=True</code> 将更新公众号列表, 并返回.</li>
</ul>
</blockquote>
</blockquote>
<h4 id="search-mps"><a href="#search-mps" class="headerlink" title="search_mps"></a>search_mps</h4><blockquote>
<ul>
<li>获取特定<code>UserName</code>的公众号</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取特定UserName的公众号，返回值为一个字典</span></div><div class="line">itchat.search_mps(userName=<span class="string">'@abcdefg1234567'</span>)</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>获取名字中还有特定字符的公众号.</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取名字中含有特定字符的公众号，返回值为一个字典的列表</span></div><div class="line">itchat.search_mps(name=<span class="string">'LittleCoder'</span>)</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>当两项都是勇士, 将仅返回特定<code>UserName</code>的公众号.</li>
</ul>
</blockquote>
<h3 id="群聊"><a href="#群聊" class="headerlink" title="群聊"></a>群聊</h3><blockquote>
<ul>
<li><code>get_chatrooms</code> : 返回完整的群聊列表.</li>
<li><code>search_chatrooms</code> : 群聊搜索.</li>
<li><code>update_chatroom</code> : 获取群聊用户列表或更新该群聊.<blockquote>
<ul>
<li>群聊在首次获取中不会获取群聊的用户列表, 所以需要调用该命令才能获取群聊成员.</li>
<li>传入群聊的 <code>UserName</code> , 返回特定群聊的详细信息.</li>
<li>传入<code>UserName</code>组成的列表, 返回指定用户的最新信息组成的列表.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">memberList = itchat.update_chatroom(<span class="string">'@@abcdefg1234567'</span>, detailedMember=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>创建群聊,增加/删除群聊用户:</li>
</ul>
<blockquote>
<ul>
<li>由于之前通过群聊检测是否被好友拉黑的程序, 目前这三个方法都被严格限制了使用频率.</li>
<li>删除群聊需要本账号为管理员, 否则无效.</li>
<li>将用户加入群聊有直接加入与发送邀请, 通过 <code>useInvitation</code> 设置.</li>
<li>超过 40 人的群聊无法使用直接加入的加入方式.</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">memberList = itchat.get_frients()[<span class="number">1</span>:]</div><div class="line"><span class="comment"># 创建群聊, topic 键值为群聊名称.</span></div><div class="line">chatroomUserName = itchat.create_chatroom(memberList, <span class="string">"test chatroom"</span>)</div><div class="line"><span class="comment"># 删除群聊内的用户</span></div><div class="line">itchat.delete_member_from_chatroom(chatroomUserName, memberList[<span class="number">0</span>])</div><div class="line"><span class="comment"># 增加用户进入群聊.</span></div><div class="line">itchat.add_member_into_chatroom(chatroomUserName, memberList[<span class="number">0</span>], useInvitation=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<h2 id="方法汇总"><a href="#方法汇总" class="headerlink" title="方法汇总"></a>方法汇总</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">itchat.add_friend                  </div><div class="line">itchat.new_instance                </div><div class="line">itchat.add_member_into_chatroom    </div><div class="line">itchat.originInstance              </div><div class="line">itchat.auto_login                  </div><div class="line">itchat.returnvalues                </div><div class="line">itchat.check_login                 </div><div class="line">itchat.run                         </div><div class="line">itchat.components                  </div><div class="line">itchat.search_chatrooms            </div><div class="line">itchat.config                      </div><div class="line">itchat.search_friends              </div><div class="line">itchat.configured_reply            </div><div class="line">itchat.search_mps                  </div><div class="line">itchat.content                     </div><div class="line">itchat.send                        </div><div class="line">itchat.core                        </div><div class="line">itchat.send_file                   </div><div class="line">itchat.Core                        </div><div class="line">itchat.send_image                  </div><div class="line">itchat.create_chatroom             </div><div class="line">itchat.send_msg                    </div><div class="line">itchat.delete_member_from_chatroom </div><div class="line">itchat.send_raw_msg                </div><div class="line">itchat.dump_login_status           </div><div class="line">itchat.send_video                  </div><div class="line">itchat.get_chatrooms               </div><div class="line">itchat.set_alias                   </div><div class="line">itchat.get_contact                 </div><div class="line">itchat.set_chatroom_name           </div><div class="line">itchat.get_friends                 </div><div class="line">itchat.set_logging                 </div><div class="line">itchat.get_head_img                </div><div class="line">itchat.set_pinned                  </div><div class="line">itchat.get_mps                     </div><div class="line">itchat.show_mobile_login           </div><div class="line">itchat.get_msg                     </div><div class="line">itchat.start_receiving             </div><div class="line">itchat.get_QR                      </div><div class="line">itchat.storage                     </div><div class="line">itchat.get_QRuuid                  </div><div class="line">itchat.update_chatroom             </div><div class="line">itchat.instanceList                </div><div class="line">itchat.update_friend               </div><div class="line">itchat.load_login_status           </div><div class="line">itchat.upload_file                 </div><div class="line">itchat.log                         </div><div class="line">itchat.utils                       </div><div class="line">itchat.login                       </div><div class="line">itchat.VERSION                     </div><div class="line">itchat.logout                      </div><div class="line">itchat.web_init                    </div><div class="line">itchat.msg_register</div></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><blockquote>
<p><strong>下面是博主写的一个程序，该程序的主要功能是监控撤回消息，并且如果有消息撤回就会撤回的消息发送给你，以后再也不用担心看不到好友的撤回的消息了，由于注释写的很详细，因此这里就不在详细的讲解了，直接贴代码</strong></p>
</blockquote>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="keyword">import</span> itchat</div><div class="line"><span class="keyword">from</span> itchat.content <span class="keyword">import</span> TEXT</div><div class="line"><span class="keyword">from</span> itchat.content <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> re</div><div class="line"></div><div class="line">reload(sys)</div><div class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line">msg_information = &#123;&#125;</div><div class="line">face_bug=<span class="keyword">None</span>  <span class="comment">#针对表情包的内容</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@itchat.msg_register([TEXT, PICTURE, FRIENDS, CARD, MAP, SHARING, RECORDING, ATTACHMENT, VIDEO],isFriendChat=True, isGroupChat=True, isMpChat=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_receive_msg</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="keyword">global</span> face_bug</div><div class="line">    msg_time_rec = time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>, time.localtime())   <span class="comment">#接受消息的时间</span></div><div class="line">    msg_from = itchat.search_friends(userName=msg[<span class="string">'FromUserName'</span>])[<span class="string">'NickName'</span>]   <span class="comment">#在好友列表中查询发送信息的好友昵称</span></div><div class="line">    msg_time = msg[<span class="string">'CreateTime'</span>]    <span class="comment">#信息发送的时间</span></div><div class="line">    msg_id = msg[<span class="string">'MsgId'</span>]    <span class="comment">#每条信息的id</span></div><div class="line">    msg_content = <span class="keyword">None</span>      <span class="comment">#储存信息的内容</span></div><div class="line">    msg_share_url = <span class="keyword">None</span>    <span class="comment">#储存分享的链接，比如分享的文章和音乐</span></div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'Type'</span>]</div><div class="line">    <span class="keyword">print</span> msg[<span class="string">'MsgId'</span>]</div><div class="line">    <span class="keyword">if</span> msg[<span class="string">'Type'</span>] == <span class="string">'Text'</span> <span class="keyword">or</span> msg[<span class="string">'Type'</span>] == <span class="string">'Friends'</span>:     <span class="comment">#如果发送的消息是文本或者好友推荐</span></div><div class="line">        msg_content = msg[<span class="string">'Text'</span>]</div><div class="line">        <span class="keyword">print</span> msg_content</div><div class="line"></div><div class="line">    <span class="comment">#如果发送的消息是附件、视屏、图片、语音</span></div><div class="line">    <span class="keyword">elif</span> msg[<span class="string">'Type'</span>] == <span class="string">"Attachment"</span> <span class="keyword">or</span> msg[<span class="string">'Type'</span>] == <span class="string">"Video"</span> \</div><div class="line">            <span class="keyword">or</span> msg[<span class="string">'Type'</span>] == <span class="string">'Picture'</span> \</div><div class="line">            <span class="keyword">or</span> msg[<span class="string">'Type'</span>] == <span class="string">'Recording'</span>:</div><div class="line">        msg_content = msg[<span class="string">'FileName'</span>]    <span class="comment">#内容就是他们的文件名</span></div><div class="line">        msg[<span class="string">'Text'</span>](str(msg_content))    <span class="comment">#下载文件</span></div><div class="line">        <span class="comment"># print msg_content</span></div><div class="line">    <span class="keyword">elif</span> msg[<span class="string">'Type'</span>] == <span class="string">'Card'</span>:    <span class="comment">#如果消息是推荐的名片</span></div><div class="line">        msg_content = msg[<span class="string">'RecommendInfo'</span>][<span class="string">'NickName'</span>] + <span class="string">'的名片'</span>    <span class="comment">#内容就是推荐人的昵称和性别</span></div><div class="line">        <span class="keyword">if</span> msg[<span class="string">'RecommendInfo'</span>][<span class="string">'Sex'</span>] == <span class="number">1</span>:</div><div class="line">            msg_content += <span class="string">'性别为男'</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            msg_content += <span class="string">'性别为女'</span></div><div class="line"></div><div class="line">        <span class="keyword">print</span> msg_content</div><div class="line">    <span class="keyword">elif</span> msg[<span class="string">'Type'</span>] == <span class="string">'Map'</span>:    <span class="comment">#如果消息为分享的位置信息</span></div><div class="line">        x, y, location = re.search(</div><div class="line">            <span class="string">"&lt;location x=\"(.*?)\" y=\"(.*?)\".*label=\"(.*?)\".*"</span>, msg[<span class="string">'OriContent'</span>]).group(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">        <span class="keyword">if</span> location <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            msg_content = <span class="string">r"纬度-&gt;"</span> + x.__str__() + <span class="string">" 经度-&gt;"</span> + y.__str__()     <span class="comment">#内容为详细的地址</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            msg_content = <span class="string">r""</span> + location</div><div class="line">    <span class="keyword">elif</span> msg[<span class="string">'Type'</span>] == <span class="string">'Sharing'</span>:     <span class="comment">#如果消息为分享的音乐或者文章，详细的内容为文章的标题或者是分享的名字</span></div><div class="line">        msg_content = msg[<span class="string">'Text'</span>]</div><div class="line">        msg_share_url = msg[<span class="string">'Url'</span>]       <span class="comment">#记录分享的url</span></div><div class="line">        <span class="keyword">print</span> msg_share_url</div><div class="line">    face_bug=msg_content</div><div class="line"></div><div class="line"><span class="comment">##将信息存储在字典中，每一个msg_id对应一条信息</span></div><div class="line">    msg_information.update(</div><div class="line">        &#123;</div><div class="line">            msg_id: &#123;</div><div class="line">                <span class="string">"msg_from"</span>: msg_from, <span class="string">"msg_time"</span>: msg_time, <span class="string">"msg_time_rec"</span>: msg_time_rec,</div><div class="line">                <span class="string">"msg_type"</span>: msg[<span class="string">"Type"</span>],</div><div class="line">                <span class="string">"msg_content"</span>: msg_content, <span class="string">"msg_share_url"</span>: msg_share_url</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    )</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##这个是用于监听是否有消息撤回</span></div><div class="line"><span class="meta">@itchat.msg_register(NOTE, isFriendChat=True, isGroupChat=True, isMpChat=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">information</span><span class="params">(msg)</span>:</span></div><div class="line">    <span class="comment">#这里如果这里的msg['Content']中包含消息撤回和id，就执行下面的语句</span></div><div class="line">    <span class="keyword">if</span> <span class="string">'撤回了一条消息'</span> <span class="keyword">in</span> msg[<span class="string">'Content'</span>]:</div><div class="line">        old_msg_id = re.search(<span class="string">"\&lt;msgid\&gt;(.*?)\&lt;\/msgid\&gt;"</span>, msg[<span class="string">'Content'</span>]).group(<span class="number">1</span>)   <span class="comment">#在返回的content查找撤回的消息的id</span></div><div class="line">        old_msg = msg_information.get(old_msg_id)    <span class="comment">#得到消息</span></div><div class="line">        <span class="keyword">print</span> old_msg</div><div class="line">        <span class="keyword">if</span> len(old_msg_id)&lt;<span class="number">11</span>:  <span class="comment">#如果发送的是表情包</span></div><div class="line">            itchat.send_file(face_bug,toUserName=<span class="string">'filehelper'</span>)</div><div class="line">        <span class="keyword">else</span>:  <span class="comment">#发送撤回的提示给文件助手</span></div><div class="line">            msg_body = <span class="string">"告诉你一个秘密~"</span> + <span class="string">"\n"</span> \</div><div class="line">                       + old_msg.get(<span class="string">'msg_from'</span>) + <span class="string">" 撤回了 "</span> + old_msg.get(<span class="string">"msg_type"</span>) + <span class="string">" 消息"</span> + <span class="string">"\n"</span> \</div><div class="line">                       + old_msg.get(<span class="string">'msg_time_rec'</span>) + <span class="string">"\n"</span> \</div><div class="line">                       + <span class="string">"撤回了什么 ⇣"</span> + <span class="string">"\n"</span> \</div><div class="line">                       + <span class="string">r""</span> + old_msg.get(<span class="string">'msg_content'</span>)</div><div class="line">            <span class="comment">#如果是分享的文件被撤回了，那么就将分享的url加在msg_body中发送给文件助手</span></div><div class="line">            <span class="keyword">if</span> old_msg[<span class="string">'msg_type'</span>] == <span class="string">"Sharing"</span>:</div><div class="line">                msg_body += <span class="string">"\n就是这个链接➣ "</span> + old_msg.get(<span class="string">'msg_share_url'</span>)</div><div class="line"></div><div class="line">            <span class="comment"># 将撤回消息发送到文件助手</span></div><div class="line">            itchat.send_msg(msg_body, toUserName=<span class="string">'filehelper'</span>)</div><div class="line">            <span class="comment"># 有文件的话也要将文件发送回去</span></div><div class="line">            <span class="keyword">if</span> old_msg[<span class="string">"msg_type"</span>] == <span class="string">"Picture"</span> \</div><div class="line">                    <span class="keyword">or</span> old_msg[<span class="string">"msg_type"</span>] == <span class="string">"Recording"</span> \</div><div class="line">                    <span class="keyword">or</span> old_msg[<span class="string">"msg_type"</span>] == <span class="string">"Video"</span> \</div><div class="line">                    <span class="keyword">or</span> old_msg[<span class="string">"msg_type"</span>] == <span class="string">"Attachment"</span>:</div><div class="line">                file = <span class="string">'@fil@%s'</span> % (old_msg[<span class="string">'msg_content'</span>])</div><div class="line">                itchat.send(msg=file, toUserName=<span class="string">'filehelper'</span>)</div><div class="line">                os.remove(old_msg[<span class="string">'msg_content'</span>])</div><div class="line">            <span class="comment"># 删除字典旧消息</span></div><div class="line">            msg_information.pop(old_msg_id)</div><div class="line"></div><div class="line">itchat.auto_login(hotReload=<span class="keyword">True</span>)</div><div class="line">itchat.run()</div></pre></td></tr></table></figure>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><blockquote>
<ul>
<li><p><a href="https://itchat.readthedocs.io/zh/latest/" target="_blank" rel="external">文档：https://itchat.readthedocs.io/zh/latest/</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/yanjingnan/p/6831464.html" target="_blank" rel="external">http://www.cnblogs.com/yanjingnan/p/6831464.html</a></p>
</li>
</ul>
</blockquote>
<h2 id="笔者有话说"><a href="#笔者有话说" class="headerlink" title="笔者有话说"></a>笔者有话说</h2><ul>
<li>最近建了一个微信交流群，提供给大家一个交流的平台，扫描下方笔者的微信二维码，备注【交流】，我会把大家拉进群</li>
</ul>
<p><img src="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg" alt=""></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://chenjiabing666.github.io/2017/05/15/python实现微信接口/" data-title="python实现微信接口 | 爱撒谎的男孩" data-tsina="5651317821" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/05/23/Java-IO学习笔记一/" title="Java IO学习笔记一">
  <strong>上一篇：</strong><br/>
  <span>
  Java IO学习笔记一</span>
</a>
</div>


<div class="next">
<a href="/2017/05/13/python发送邮件/"  title="python发送邮件">
 <strong>下一篇：</strong><br/> 
 <span>python发送邮件
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#python实现微信接口-itchat"><span class="toc-number">1.</span> <span class="toc-text">python实现微信接口(itchat)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#登录"><span class="toc-number">1.2.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#退出及登录完成后调用的特定的方法"><span class="toc-number">1.3.</span> <span class="toc-text">退出及登录完成后调用的特定的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回复消息"><span class="toc-number">1.4.</span> <span class="toc-text">回复消息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#send"><span class="toc-number">1.4.1.</span> <span class="toc-text">send</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-msg"><span class="toc-number">1.4.2.</span> <span class="toc-text">send_msg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-file"><span class="toc-number">1.4.3.</span> <span class="toc-text">send_file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-image"><span class="toc-number">1.4.4.</span> <span class="toc-text">send_image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#send-video"><span class="toc-number">1.4.5.</span> <span class="toc-text">send_video</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册消息方法"><span class="toc-number">1.5.</span> <span class="toc-text">注册消息方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注册方法"><span class="toc-number">1.5.1.</span> <span class="toc-text">注册方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#附件的下载与发送"><span class="toc-number">1.5.2.</span> <span class="toc-text">附件的下载与发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#群消息"><span class="toc-number">1.5.3.</span> <span class="toc-text">群消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册消息的优先级"><span class="toc-number">1.6.</span> <span class="toc-text">注册消息的优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息内容"><span class="toc-number">1.7.</span> <span class="toc-text">消息内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一般消息"><span class="toc-number">1.7.1.</span> <span class="toc-text">一般消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化消息"><span class="toc-number">1.7.2.</span> <span class="toc-text">初始化消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文本消息"><span class="toc-number">1.7.3.</span> <span class="toc-text">文本消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片消息"><span class="toc-number">1.7.4.</span> <span class="toc-text">图片消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视频消息"><span class="toc-number">1.7.5.</span> <span class="toc-text">视频消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地理位置消息"><span class="toc-number">1.7.6.</span> <span class="toc-text">地理位置消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#名片消息"><span class="toc-number">1.7.7.</span> <span class="toc-text">名片消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#语音消息"><span class="toc-number">1.7.8.</span> <span class="toc-text">语音消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动画表情"><span class="toc-number">1.7.9.</span> <span class="toc-text">动画表情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#普通链接或应用分享消息"><span class="toc-number">1.7.10.</span> <span class="toc-text">普通链接或应用分享消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#音乐链接消息"><span class="toc-number">1.7.11.</span> <span class="toc-text">音乐链接消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#群消息-1"><span class="toc-number">1.7.12.</span> <span class="toc-text">群消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#红包消息"><span class="toc-number">1.7.13.</span> <span class="toc-text">红包消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统消息"><span class="toc-number">1.7.14.</span> <span class="toc-text">系统消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#账号类型"><span class="toc-number">1.8.</span> <span class="toc-text">账号类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#好友"><span class="toc-number">1.8.1.</span> <span class="toc-text">好友</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get-friends"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">get_friends</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#search-friends"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">search_friends</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update-friend"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">update_friend</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#公众号"><span class="toc-number">1.8.2.</span> <span class="toc-text">公众号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get-mps"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">get_mps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#search-mps"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">search_mps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#群聊"><span class="toc-number">1.8.3.</span> <span class="toc-text">群聊</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#方法汇总"><span class="toc-number">1.9.</span> <span class="toc-text">方法汇总</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例"><span class="toc-number">1.10.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码"><span class="toc-number">1.10.1.</span> <span class="toc-text">代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-number">1.11.</span> <span class="toc-text">参考文章</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#笔者有话说"><span class="toc-number">1.12.</span> <span class="toc-text">笔者有话说</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hibernate/" title="Hibernate">Hibernate<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Web/" title="Java-Web">Java-Web<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/MyBatis/" title="MyBatis">MyBatis<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring/" title="Spring">Spring<sup>39</sup></a></li>
		  
		
		  
			<li><a href="/categories/SpringBoot/" title="SpringBoot">SpringBoot<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/Struts2/" title="Struts2">Struts2<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker/" title="docker">docker<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/java学习/" title="java学习">java学习<sup>35</sup></a></li>
		  
		
		  
			<li><a href="/categories/java并发编程/" title="java并发编程">java并发编程<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>19</sup></a></li>
		  
		
		  
			<li><a href="/categories/web前端/" title="web前端">web前端<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/分布式/" title="分布式">分布式<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库干货篇/" title="数据库干货篇">数据库干货篇<sup>20</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂谈/" title="杂谈">杂谈<sup>22</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>9</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>39</sup></a></li>
			
		
			
				<li><a href="/tags/杂谈/" title="杂谈">杂谈<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/java基础/" title="java基础">java基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/python爬虫/" title="python爬虫">python爬虫<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/java并发编程/" title="java并发编程">java并发编程<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/SpringBoot/" title="SpringBoot">SpringBoot<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/SQL/" title="SQL">SQL<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/分布式/" title="分布式">分布式<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Struts2/" title="Struts2">Struts2<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/java-IO编程/" title="java IO编程">java IO编程<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Redis/" title="Redis">Redis<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/MyBatis/" title="MyBatis">MyBatis<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/web前端/" title="web前端">web前端<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E4%B8%83%E7%A7%92%E7%BC%96%E7%A8%8B.jpg" target="_blank" title="微信公众号">微信公众号</a>
            
          </li>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.zhihu.com/people/xiao-ming-64-34-45/activities" target="_blank" title="本人知乎">本人知乎</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.cnblogs.com/Chenjiabing/" target="_blank" title="本人博客园">本人博客园</a>
            
          </li>
        
          <li>
            
            	<a href="https://blog.csdn.net/qq_34162294" target="_blank" title="本人CSDN">本人CSDN</a>
            
          </li>
        
          <li>
            
            	<a href="https://juejin.im/user/2506542244708072" target="_blank" title="本人掘金">本人掘金</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 欢迎关注微信公众号：码猿技术专栏 <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	 <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=14509119671822169205' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5651317821" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/chenjiabing666" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/155022807" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/https://www.zhihu.com/people/xiao-ming-64-34-45" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="不才陈某">不才陈某</a>
		
		
		</p>
		
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    $('#toc.toc-aside').css('display', 'block').addClass('fadeIn');//新加的，打开文章时自动隐藏左边的栏
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'chenjiabing666';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261577779'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s23.cnzz.com/z_stat.php%3Fid%3D1261577779' type='text/javascript'%3E%3C/script%3E"));</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

    <script type="text/javascript" src="/js/src/love.js"></script>

  </body>
  
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</html>
