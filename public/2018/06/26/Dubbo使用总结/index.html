
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
  
    <title>Dubbo使用总结 | 爱撒谎的男孩</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="不才陈某">
    

    
    <meta name="description" content="Dubbo常见问题官方文档
中文文档

启动检查
Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 check=&amp;quot;true&amp;quot;可以通过 check=&amp;quot;false&amp;quot; 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。
另外，如果你的 Spring 容">
<meta property="og:type" content="article">
<meta property="og:title" content="Dubbo使用总结">
<meta property="og:url" content="http://chenjiabing666.github.io/2018/06/26/Dubbo使用总结/index.html">
<meta property="og:site_name" content="爱撒谎的男孩">
<meta property="og:description" content="Dubbo常见问题官方文档
中文文档

启动检查
Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 check=&amp;quot;true&amp;quot;可以通过 check=&amp;quot;false&amp;quot; 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。
另外，如果你的 Spring 容">
<meta property="og:image" content="http://dubbo.apache.org/books/dubbo-user-book/sources/images/dubbo-token.jpg">
<meta property="og:image" content="http://dubbo.apache.org/books/dubbo-user-book/sources/images/dubbo-protocol.jpg">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/270324/201609/270324-20160910122039394-1078905366.png">
<meta property="og:image" content="http://dubbo.apache.org/books/dubbo-user-book/sources/images/context.png">
<meta property="og:image" content="http://dubbo.apache.org/books/dubbo-user-book/sources/images/future.jpg">
<meta property="og:image" content="https://images2017.cnblogs.com/blog/296430/201801/296430-20180109111413879-348600461.png">
<meta property="og:image" content="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg">
<meta property="og:updated_time" content="2020-03-13T05:52:59.327Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dubbo使用总结">
<meta name="twitter:description" content="Dubbo常见问题官方文档
中文文档

启动检查
Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 check=&amp;quot;true&amp;quot;可以通过 check=&amp;quot;false&amp;quot; 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。
另外，如果你的 Spring 容">
<meta name="twitter:image" content="http://dubbo.apache.org/books/dubbo-user-book/sources/images/dubbo-token.jpg">

    
    <link rel="alternative" href="/atom.xml" title="爱撒谎的男孩" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/avatar.jpg" alt="爱撒谎的男孩" title="爱撒谎的男孩"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="爱撒谎的男孩">爱撒谎的男孩</a></h1>
				<h2 class="blog-motto">微信公众号：码猿技术专栏</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives/">归档</a></li>
					
						<li><a href="/about/">关于我</a></li>
					
					<li>
 					
						<form class="search" action="https://chenjiabing666.github.io/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 14509119671822170000 ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>	
			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/06/26/Dubbo使用总结/" title="Dubbo使用总结" itemprop="url">Dubbo使用总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="不才陈某" target="_blank" itemprop="author">不才陈某</a>
		
  <p class="article-time">
    <time datetime="2018-06-26T14:41:16.000Z" itemprop="datePublished"> 发表于 2018-06-26</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Dubbo常见问题"><span class="toc-number">1.</span> <span class="toc-text">Dubbo常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#官方文档"><span class="toc-number">1.1.</span> <span class="toc-text">官方文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动检查"><span class="toc-number">1.2.</span> <span class="toc-text">启动检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置方式"><span class="toc-number">1.2.1.</span> <span class="toc-text">配置方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭某个服务的检查"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">关闭某个服务的检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭所有服务的检查"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">关闭所有服务的检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭注册中心启动时检查"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">关闭注册中心启动时检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dubbo-properties"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">dubbo.properties</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#负载均衡策略"><span class="toc-number">1.3.</span> <span class="toc-text">负载均衡策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多协议"><span class="toc-number">1.4.</span> <span class="toc-text">多协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#不同服务不同协议"><span class="toc-number">1.4.1.</span> <span class="toc-text">不同服务不同协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多协议暴露服务"><span class="toc-number">1.4.2.</span> <span class="toc-text">多协议暴露服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多版本"><span class="toc-number">1.5.</span> <span class="toc-text">多版本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">1.5.1.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务分组"><span class="toc-number">1.6.</span> <span class="toc-text">服务分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务"><span class="toc-number">1.6.1.</span> <span class="toc-text">服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引用"><span class="toc-number">1.6.2.</span> <span class="toc-text">引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#令牌验证"><span class="toc-number">1.7.</span> <span class="toc-text">令牌验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dubbo控制台的安装部署"><span class="toc-number">1.8.</span> <span class="toc-text">dubbo控制台的安装部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程模型"><span class="toc-number">1.9.</span> <span class="toc-text">线程模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多注册中心"><span class="toc-number">1.10.</span> <span class="toc-text">多注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多注册中心注册"><span class="toc-number">1.10.1.</span> <span class="toc-text">多注册中心注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同服务使用不同注册中心"><span class="toc-number">1.10.2.</span> <span class="toc-text">不同服务使用不同注册中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多注册中心引用"><span class="toc-number">1.10.3.</span> <span class="toc-text">多注册中心引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分组聚合"><span class="toc-number">1.11.</span> <span class="toc-text">分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">1.11.1.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置文件覆盖策略"><span class="toc-number">1.12.</span> <span class="toc-text">配置文件覆盖策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回声测试"><span class="toc-number">1.13.</span> <span class="toc-text">回声测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#上下文信息"><span class="toc-number">1.14.</span> <span class="toc-text">上下文信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务消费方"><span class="toc-number">1.14.1.</span> <span class="toc-text">服务消费方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务提供方"><span class="toc-number">1.14.2.</span> <span class="toc-text">服务提供方</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#隐式参数"><span class="toc-number">1.15.</span> <span class="toc-text">隐式参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在服务消费方端设置隐式参数"><span class="toc-number">1.15.1.</span> <span class="toc-text">在服务消费方端设置隐式参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在服务提供方端获取隐式参数"><span class="toc-number">1.15.2.</span> <span class="toc-text">在服务提供方端获取隐式参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异步调用"><span class="toc-number">1.16.</span> <span class="toc-text">异步调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#本地存根"><span class="toc-number">1.17.</span> <span class="toc-text">本地存根</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现步骤"><span class="toc-number">1.17.1.</span> <span class="toc-text">实现步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.17.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#本地伪装"><span class="toc-number">1.18.</span> <span class="toc-text">本地伪装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延迟暴露"><span class="toc-number">1.19.</span> <span class="toc-text">延迟暴露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发控制"><span class="toc-number">1.20.</span> <span class="toc-text">并发控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接控制"><span class="toc-number">1.21.</span> <span class="toc-text">连接控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延迟连接"><span class="toc-number">1.22.</span> <span class="toc-text">延迟连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#粘滞连接"><span class="toc-number">1.23.</span> <span class="toc-text">粘滞连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#笔者有话说"><span class="toc-number">1.24.</span> <span class="toc-text">笔者有话说</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="Dubbo常见问题"><a href="#Dubbo常见问题" class="headerlink" title="Dubbo常见问题"></a>Dubbo常见问题</h1><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><ul>
<li><a href="http://dubbo.apache.org/books/dubbo-user-book/demos/preflight-check.html" target="_blank" rel="external">中文文档</a></li>
</ul>
<h2 id="启动检查"><a href="#启动检查" class="headerlink" title="启动检查"></a>启动检查</h2><blockquote>
<p>Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 <code>check=&quot;true&quot;</code><br>可以通过 <code>check=&quot;false&quot;</code> 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。</p>
<p>另外，如果你的 Spring 容器是懒加载的，或者通过 API 编程延迟引用服务，请关闭 check，否则服务临时不可用时，会抛出异常，拿到 null 引用，如果 <code>check=&quot;false&quot;</code>，总是会返回引用，当服务恢复时，能自动连上</p>
<p><strong>如果在服务提供者没有上线的情况下，我们需要提前将消费者上线，那么就可以关闭启动检查，这样当消费者启动但是不调用服务的情况下不会报错，保证正常启动</strong></p>
</blockquote>
<h3 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h3><h4 id="关闭某个服务的检查"><a href="#关闭某个服务的检查" class="headerlink" title="关闭某个服务的检查"></a>关闭某个服务的检查</h4><ol>
<li><p><code>&lt;dubbo:reference id=&quot;helloService&quot; interface=&quot;cn.tedu.service.IHelloService&quot; check=&quot;false&quot;/&gt;</code> ：关闭某个服务的启动时检查</p>
<ol>
<li>这个只会关闭当前的服务器的检查，还是会检查其他的服务</li>
<li>在没有对应服务提供者的情况下如果调用这个服务那么将会报错</li>
<li>在消费者中配置</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDubbo</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ClassPathXmlApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"appliactionContext.xml"</span>);</div><div class="line">		IHelloService helloService=context.getBean(<span class="string">"helloService"</span>,IHelloService.class);</div><div class="line">        <span class="comment">//现在没有调用服务的情况下不会报错，但是如果调用了HelloService中的方法，那么将会报错</span></div><div class="line"><span class="comment">//		helloService.sayHello();</span></div><div class="line">		context.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>如果没有关闭检查，那么会出现如下的错误</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Exception in thread "main" org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloService': FactoryBean threw exception on object creation; nested exception is java.lang.IllegalStateException: Failed to check the status of the service cn.tedu.service.IHelloService. No provider available for the service cn.tedu.service.IHelloService from the url zookeeper://39.105.123.197:2181/com.alibaba.dubbo.registry.RegistryService?application=dubbo-consum01&amp;dubbo=2.5.3&amp;interface=cn.tedu.service.IHelloService&amp;methods=sayHello&amp;pid=10974&amp;revision=0.0.1&amp;side=consumer&amp;timestamp=1529667926718 to the consumer 10.18.236.4 use dubbo version 2.5.3</div><div class="line">	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.doGetObjectFromFactoryBean(FactoryBeanRegistrySupport.java:175)</div><div class="line">	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.getObjectFromFactoryBean(FactoryBeanRegistrySupport.java:103)</div><div class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.getObjectForBeanInstance(AbstractBeanFactory.java:1634)</div><div class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:254)</div><div class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)</div><div class="line">	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1086)</div><div class="line">	at TestDubbo.main(TestDubbo.java:9)</div><div class="line">Caused by: java.lang.IllegalStateException: Failed to check the status of the service cn.tedu.service.IHelloService. No provider available for the service cn.tedu.service.IHelloService from the url zookeeper://39.105.123.197:2181/com.alibaba.dubbo.registry.RegistryService?application=dubbo-consum01&amp;dubbo=2.5.3&amp;interface=cn.tedu.service.IHelloService&amp;methods=sayHello&amp;pid=10974&amp;revision=0.0.1&amp;side=consumer&amp;timestamp=1529667926718 to the consumer 10.18.236.4 use dubbo version 2.5.3</div><div class="line">	at com.alibaba.dubbo.config.ReferenceConfig.createProxy(ReferenceConfig.java:420)</div><div class="line">	at com.alibaba.dubbo.config.ReferenceConfig.init(ReferenceConfig.java:300)</div><div class="line">	at com.alibaba.dubbo.config.ReferenceConfig.get(ReferenceConfig.java:138)</div><div class="line">	at com.alibaba.dubbo.config.spring.ReferenceBean.getObject(ReferenceBean.java:65)</div><div class="line">	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.doGetObjectFromFactoryBean(FactoryBeanRegistrySupport.java:168)</div><div class="line">	... 6 more</div></pre></td></tr></table></figure>
<h4 id="关闭所有服务的检查"><a href="#关闭所有服务的检查" class="headerlink" title="关闭所有服务的检查"></a>关闭所有服务的检查</h4><blockquote>
<p>关闭所有服务的检查</p>
<p>在消费者的配置文件中配置即可</p>
<p><code>&lt;dubbo:consumer check=&quot;false&quot; /&gt;</code></p>
</blockquote>
<h4 id="关闭注册中心启动时检查"><a href="#关闭注册中心启动时检查" class="headerlink" title="关闭注册中心启动时检查"></a>关闭注册中心启动时检查</h4><blockquote>
<p>注册订阅失败的时候报错</p>
<p><code>&lt;dubbo:registry check=&quot;false&quot; /&gt;</code></p>
</blockquote>
<h4 id="dubbo-properties"><a href="#dubbo-properties" class="headerlink" title="dubbo.properties"></a>dubbo.properties</h4><ul>
<li><p>在<code>src/main/resource</code>文件夹下新建<code>dubbo.properties</code></p>
</li>
<li><p><strong>在其中添加如下内容</strong></p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dubbo.reference.com.foo.BarService.check=false</div><div class="line">dubbo.reference.check=false</div><div class="line">dubbo.consumer.check=false</div><div class="line">dubbo.registry.check=false</div></pre></td></tr></table></figure>
</li>
<li><p><strong>只需要添加这个文件即可，会自动设置</strong></p>
</li>
</ul>
<h2 id="负载均衡策略"><a href="#负载均衡策略" class="headerlink" title="负载均衡策略"></a>负载均衡策略</h2><ul>
<li><p>这个在集群部署的时候会用到，比如多台机器提供的是同一个服务，那么当浏览器请求服务的时候到底该调用哪台机器上的服务才会更好，此时就需要用到负载均衡策略</p>
</li>
<li><p><a href="https://www.cnblogs.com/qingfengbuluo/p/5527930.html" target="_blank" rel="external">优秀博文</a></p>
</li>
</ul>
<h2 id="多协议"><a href="#多协议" class="headerlink" title="多协议"></a>多协议</h2><ul>
<li>在dubbo中存在8中不同的协议，这些协议的作用都是不同的，此时我们需要根据服务的功能来使用不同的协议，比如我们需要上传文件，那么就需要能够传输大文件的协议</li>
<li>默认是dubbo协议，也是用的最多的协议</li>
</ul>
<h3 id="不同服务不同协议"><a href="#不同服务不同协议" class="headerlink" title="不同服务不同协议"></a>不同服务不同协议</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 多协议配置 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rmi"</span> <span class="attr">port</span>=<span class="string">"1099"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 使用dubbo协议暴露服务，直接使用protocol关键词引用上面配置的协议 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">ref</span>=<span class="string">"helloService"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 使用rmi协议暴露服务 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.DemoService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">protocol</span>=<span class="string">"rmi"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h3 id="多协议暴露服务"><a href="#多协议暴露服务" class="headerlink" title="多协议暴露服务"></a>多协议暴露服务</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 多协议配置 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"hessian"</span> <span class="attr">port</span>=<span class="string">"8080"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 使用多个协议暴露服务 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">protocol</span>=<span class="string">"dubbo,hessian"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="多版本"><a href="#多版本" class="headerlink" title="多版本"></a>多版本</h2><ul>
<li>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。<br>可以按照以下的步骤进行版本迁移：<ol>
<li>在低压力时间段，先升级一半提供者为新版本</li>
<li>再将所有消费者升级为新版本</li>
<li>然后将剩下的一半提供者升级为新版本</li>
</ol>
</li>
<li>直接使用<code>version</code>指定版本即可</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ul>
<li>我们有一个<code>HelloService</code>接口，但是有两个实现类，分别为<code>HelloServiceImpl1</code>,<code>HelloServiceImpl2</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceImpl1</span> <span class="keyword">implements</span> <span class="title">IHelloService</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"say helloService1"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceImpl2</span> <span class="keyword">implements</span> <span class="title">IHelloService</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"say helloservice2"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置服务提供者，需要根据版本的不同提供服务</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置应用名字，用来标识每一个应用，这里的name最好和工程名字一样 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-provider01"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 使用zookeeper注册中心暴露服务 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://39.105.123.197:2181"</span> /&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 配置服务的接口实现类，这样当提供服务调用的接口的时候才能找到对应的实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService1"</span> <span class="attr">class</span>=<span class="string">"cn.tedu.servivceImpl.HelloServiceImpl1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 配置服务的接口实现类，这样当提供服务调用的接口的时候才能找到对应的实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService2"</span> <span class="attr">class</span>=<span class="string">"cn.tedu.servivceImpl.HelloServiceImpl2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line">    </div><div class="line">	<span class="comment">&lt;!-- 配置服务提供者,版本为1.0，使用的是helloService1实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.IHelloService"</span> <span class="attr">ref</span>=<span class="string">"helloService1"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></div><div class="line">		</div><div class="line">	<span class="comment">&lt;!-- 配置服务提供者,版本为2.0，使用的是helloService2实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.IHelloService"</span> <span class="attr">ref</span>=<span class="string">"helloService2"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>配置服务消费者，需要指定版本号区分调用的服务<ul>
<li>根据版本号区分调用哪个服务</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--调用2.0版本的服务--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"helloService2"</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.IHelloService"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--调用1.0版本的服务--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"helloService1"</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.IHelloService"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>/&gt;</span></div></pre></td></tr></table></figure>
<h2 id="服务分组"><a href="#服务分组" class="headerlink" title="服务分组"></a>服务分组</h2><ul>
<li>当一个接口有多种实现的时候，我们可以使用分组区分调用的服务功能</li>
<li>假设一个支付的接口<code>PayService</code>，其中实现的类有微信支付<code>WeChatPayServiceImpl</code>和支付宝支付<code>AliPayServiceImpl</code>,那么我们可以使用分组进行区分两种服务</li>
</ul>
<h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><ul>
<li>在服务提供者的配置文件中定义</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aliPayServiceImpl"</span> <span class="attr">class</span>=<span class="string">"cn.tedu.serviceImpl.AliPayServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"weChatPayServiceImpl"</span> <span class="attr">class</span>=<span class="string">"cn.tedu.serviceImpl.WeChatPayServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--使用group区分不同的服务功能 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">group</span>=<span class="string">"alipay"</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.PayService"</span> <span class="attr">ref</span>=<span class="string">"aliPayServiceImpl"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">group</span>=<span class="string">"weChatPay"</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.PayService"</span> <span class="attr">ref</span>=<span class="string">"weChatPayServiceImpl"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><ul>
<li>在消费者的配置文件中配置即可，使用<code>group</code>指定需要引用的服务</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"alipayService"</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.PayService"</span> <span class="attr">group</span>=<span class="string">"alipay"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"weChatPayService"</span> <span class="attr">interface</span>=<span class="string">"cn.tedu.service.PayService"</span> <span class="attr">group</span>=<span class="string">"weChatPay"</span>/&gt;</span></div></pre></td></tr></table></figure>
<h2 id="令牌验证"><a href="#令牌验证" class="headerlink" title="令牌验证"></a>令牌验证</h2><p>通过令牌验证在注册中心控制权限，以决定要不要下发令牌给消费者，可以防止消费者绕过注册中心访问提供者，另外通过注册中心可灵活改变授权方式，而不需修改或升级提供者</p>
<p><img src="http://dubbo.apache.org/books/dubbo-user-book/sources/images/dubbo-token.jpg" alt="/user-guide/images/dubbo-token.jpg"></p>
<p>可以全局设置开启令牌验证：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--随机token令牌，使用UUID生成--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">token</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--固定token令牌，相当于密码--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">token</span>=<span class="string">"123456"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>也可在服务级别设置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--随机token令牌，使用UUID生成--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">token</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--固定token令牌，相当于密码--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">token</span>=<span class="string">"123456"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>还可在协议级别设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--随机token令牌，使用UUID生成--&gt;</div><div class="line">&lt;dubbo:protocol name=&quot;dubbo&quot; token=&quot;true&quot; /&gt;</div></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--固定token令牌，相当于密码--&gt;</div><div class="line">&lt;dubbo:protocol name=&quot;dubbo&quot; token=&quot;123456&quot; /&gt;</div></pre></td></tr></table></figure>
<h2 id="dubbo控制台的安装部署"><a href="#dubbo控制台的安装部署" class="headerlink" title="dubbo控制台的安装部署"></a>dubbo控制台的安装部署</h2><ul>
<li>下载dubbo-admin.war : <strong>链接：<a href="https://pan.baidu.com/s/1ggeIIHX" target="_blank" rel="external">https://pan.baidu.com/s/1ggeIIHX</a> 密码：ck4h</strong></li>
<li><a href="https://blog.csdn.net/enson16855/article/details/9140771" target="_blank" rel="external">优秀博文</a></li>
</ul>
<h2 id="线程模型"><a href="#线程模型" class="headerlink" title="线程模型"></a>线程模型</h2><p>如果事件处理的逻辑能迅速完成，并且不会发起新的 IO 请求，比如只是在内存中记个标识，则直接在 IO 线程上处理更快，因为减少了线程池调度。</p>
<p>但如果事件处理逻辑较慢，或者需要发起新的 IO 请求，比如需要查询数据库，则必须派发到线程池，否则 IO 线程阻塞，将导致不能接收其它请求。</p>
<p>如果用 IO 线程处理事件，又在事件处理过程中发起新的 IO 请求，比如在连接事件中发起登录请求，会报“可能引发死锁”异常，但不会真死锁。</p>
<p><img src="http://dubbo.apache.org/books/dubbo-user-book/sources/images/dubbo-protocol.jpg" alt="dubbo-protocol"></p>
<p>因此，需要通过不同的派发策略和不同的线程池配置的组合来应对不同的场景:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">dispatcher</span>=<span class="string">"all"</span> <span class="attr">threadpool</span>=<span class="string">"fixed"</span> <span class="attr">threads</span>=<span class="string">"100"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>Dispatcher</p>
<ul>
<li><code>all</code> 所有消息都派发到线程池，包括请求，响应，连接事件，断开事件，心跳等。</li>
<li><code>direct</code> 所有消息都不派发到线程池，全部在 IO 线程上直接执行。</li>
<li><code>message</code> 只有请求响应消息派发到线程池，其它连接断开事件，心跳等消息，直接在 IO 线程上执行。</li>
<li><code>execution</code> 只请求消息派发到线程池，不含响应，响应和其它连接断开事件，心跳等消息，直接在 IO 线程上执行。</li>
<li><code>connection</code> 在 IO 线程上，将连接断开事件放入队列，有序逐个执行，其它消息派发到线程池。</li>
</ul>
<p>ThreadPool</p>
<ul>
<li><code>fixed</code> 固定大小线程池，启动时建立线程，不关闭，一直持有。(缺省)</li>
<li><code>cached</code> 缓存线程池，空闲一分钟自动删除，需要时重建。</li>
<li><code>limited</code> 可伸缩线程池，但池中的线程数只会增长不会收缩。只增长不收缩的目的是为了避免收缩时突然来了大流量引起的性能问题。</li>
<li><code>eager</code> 优先创建<code>Worker</code>线程池。在任务数量大于<code>corePoolSize</code>但是小于<code>maximumPoolSize</code>时，优先创建<code>Worker</code>来处理任务。当任务数量大于<code>maximumPoolSize</code>时，将任务放入阻塞队列中。阻塞队列充满时抛出<code>RejectedExecutionException</code>。(相比于<code>cached</code>:<code>cached</code>在任务数量超过<code>maximumPoolSize</code>时直接抛出异常而不是将任务放入阻塞队列)</li>
</ul>
<h2 id="多注册中心"><a href="#多注册中心" class="headerlink" title="多注册中心"></a>多注册中心</h2><p>Dubbo 支持同一服务向多注册中心同时注册，或者不同服务分别注册到不同的注册中心上去，甚至可以同时引用注册在不同注册中心上的同名服务。另外，注册中心是支持自定义扩展的 <a href="http://dubbo.apache.org/books/dubbo-user-book/demos/multi-registry.html#fn_1" target="_blank" rel="external">1</a>。</p>
<h3 id="多注册中心注册"><a href="#多注册中心注册" class="headerlink" title="多注册中心注册"></a>多注册中心注册</h3><p>比如：中文站有些服务来不及在青岛部署，只在杭州部署，而青岛的其它应用需要引用此服务，就可以将服务同时注册到两个注册中心。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"world"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 多注册中心配置 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"hangzhouRegistry"</span> <span class="attr">address</span>=<span class="string">"10.20.141.150:9090"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"qingdaoRegistry"</span> <span class="attr">address</span>=<span class="string">"10.20.141.151:9010"</span> <span class="attr">default</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 向多个注册中心注册 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">ref</span>=<span class="string">"helloService"</span> <span class="attr">registry</span>=<span class="string">"hangzhouRegistry,qingdaoRegistry"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="不同服务使用不同注册中心"><a href="#不同服务使用不同注册中心" class="headerlink" title="不同服务使用不同注册中心"></a>不同服务使用不同注册中心</h3><p>比如：CRM 有些服务是专门为国际站设计的，有些服务是专门为中文站设计的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"world"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 多注册中心配置 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"chinaRegistry"</span> <span class="attr">address</span>=<span class="string">"10.20.141.150:9090"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"intlRegistry"</span> <span class="attr">address</span>=<span class="string">"10.20.154.177:9010"</span> <span class="attr">default</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 向中文站注册中心注册 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">ref</span>=<span class="string">"helloService"</span> <span class="attr">registry</span>=<span class="string">"chinaRegistry"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 向国际站注册中心注册 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.DemoService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">registry</span>=<span class="string">"intlRegistry"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="多注册中心引用"><a href="#多注册中心引用" class="headerlink" title="多注册中心引用"></a>多注册中心引用</h3><p>比如：CRM 需同时调用中文站和国际站的 PC2 服务，PC2 在中文站和国际站均有部署，接口及版本号都一样，但连的数据库不一样。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"world"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 多注册中心配置 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"chinaRegistry"</span> <span class="attr">address</span>=<span class="string">"10.20.141.150:9090"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"intlRegistry"</span> <span class="attr">address</span>=<span class="string">"10.20.154.177:9010"</span> <span class="attr">default</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 引用中文站服务 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"chinaHelloService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">registry</span>=<span class="string">"chinaRegistry"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 引用国际站站服务 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"intlHelloService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">registry</span>=<span class="string">"intlRegistry"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如果只是测试环境临时需要连接两个不同注册中心，使用竖号分隔多个不同注册中心地址：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"world"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 多注册中心配置，竖号分隔表示同时连接多个不同注册中心，同一注册中心的多个集群地址用逗号分隔 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"10.20.141.150:9090|10.20.154.177:9010"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 引用服务 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.hello.api.HelloService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="分组聚合"><a href="#分组聚合" class="headerlink" title="分组聚合"></a>分组聚合</h2><p>按组合并返回结果 <a href="http://dubbo.apache.org/books/dubbo-user-book/demos/group-merger.html#fn_1" target="_blank" rel="external">1</a>，比如菜单服务，接口一样，但有多种实现，用group区分，现在消费方需从每种group中调用一次返回结果，合并结果返回，这样就可以实现聚合菜单项。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>搜索所有分组</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MenuService"</span> <span class="attr">group</span>=<span class="string">"*"</span> <span class="attr">merger</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>合并指定分组</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MenuService"</span> <span class="attr">group</span>=<span class="string">"aaa,bbb"</span> <span class="attr">merger</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>指定方法合并结果，其它未指定的方法，将只调用一个 Group</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MenuService"</span> <span class="attr">group</span>=<span class="string">"*"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getMenuItems"</span> <span class="attr">merger</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></div></pre></td></tr></table></figure>
<p>某个方法不合并结果，其它都合并结果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MenuService"</span> <span class="attr">group</span>=<span class="string">"*"</span> <span class="attr">merger</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getMenuItems"</span> <span class="attr">merger</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></div></pre></td></tr></table></figure>
<p>指定合并策略，缺省根据返回值类型自动匹配，如果同一类型有两个合并器时，需指定合并器的名称 <a href="http://dubbo.apache.org/books/dubbo-user-book/demos/group-merger.html#fn_2" target="_blank" rel="external">2</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MenuService"</span> <span class="attr">group</span>=<span class="string">"*"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getMenuItems"</span> <span class="attr">merger</span>=<span class="string">"mymerge"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></div></pre></td></tr></table></figure>
<p>指定合并方法，将调用返回结果的指定方法进行合并，合并方法的参数类型必须是返回结果类型本身</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MenuService"</span> <span class="attr">group</span>=<span class="string">"*"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getMenuItems"</span> <span class="attr">merger</span>=<span class="string">".addAll"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="配置文件覆盖策略"><a href="#配置文件覆盖策略" class="headerlink" title="配置文件覆盖策略"></a>配置文件覆盖策略</h2><ul>
<li>消费者中的相同的配置将会覆盖提供者的配置</li>
<li><img src="https://images2015.cnblogs.com/blog/270324/201609/270324-20160910122039394-1078905366.png" alt=""></li>
</ul>
<h2 id="回声测试"><a href="#回声测试" class="headerlink" title="回声测试"></a>回声测试</h2><ul>
<li>回声测试用于检测服务是否可用，回声测试按照正常请求流程执行，能够测试整个调用是否通畅，可用于监控。所有服务自动实现 <code>EchoService</code> 接口，只需将任意服务引用强制转型为 <code>EchoService</code>，即可使用。</li>
<li>Spring 配置：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"memberService"</span> <span class="attr">interface</span>=<span class="string">"com.xxx.MemberService"</span> /&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 远程服务引用</span></div><div class="line">MemberService memberService = ctx.getBean(<span class="string">"memberService"</span>); </div><div class="line"></div><div class="line">EchoService echoService = (EchoService) memberService; <span class="comment">// 强制转型为EchoService</span></div><div class="line"></div><div class="line"><span class="comment">// 回声测试可用性</span></div><div class="line">String status = echoService.$echo(<span class="string">"OK"</span>); </div><div class="line"></div><div class="line"><span class="keyword">assert</span>(status.equals(<span class="string">"OK"</span>));</div></pre></td></tr></table></figure>
<h2 id="上下文信息"><a href="#上下文信息" class="headerlink" title="上下文信息"></a>上下文信息</h2><ul>
<li><code>RpcContext</code>是一个 <code>ThreadLocal</code>的临时状态记录器，当接收到 RPC 请求，或发起 RPC 请求时，RpcContext 的状态都会变化。比如：A 调 B，B 再调 C，则 B 机器上，在 B 调 C 之前，RpcContext 记录的是 A 调 B 的信息，在 B 调 C 之后，RpcContext 记录的是 B 调 C 的信息。</li>
<li>RpcContext的状态是随时变化的，只会存储最近调用的信息</li>
</ul>
<h3 id="服务消费方"><a href="#服务消费方" class="headerlink" title="服务消费方"></a>服务消费方</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDubbo</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ClassPathXmlApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"appliactionContext.xml"</span>);</div><div class="line">		IHelloService helloService=context.getBean(<span class="string">"helloService"</span>,IHelloService.class);</div><div class="line">		<span class="comment">//执行服务，只有执行服务才会认定为消费端</span></div><div class="line">		helloService.sayHello();</div><div class="line">		<span class="comment">//测试是否是消费者</span></div><div class="line">		Boolean flag=RpcContext.getContext().isConsumerSide();</div><div class="line">		System.out.println(flag);</div><div class="line">		<span class="comment">//获取提供者的ip地址</span></div><div class="line">		String ip=RpcContext.getContext().getRemoteHost();</div><div class="line">		System.out.println(ip);</div><div class="line">		<span class="comment">//获取调用者的名称，这里的application是&lt;dubbo:application&gt;标签中的名字</span></div><div class="line">		String parameters=RpcContext.getContext().getUrl().getParameter(<span class="string">"application"</span>);</div><div class="line">		System.out.println(parameters);</div><div class="line">		context.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="服务提供方"><a href="#服务提供方" class="headerlink" title="服务提供方"></a>服务提供方</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XxxServiceImpl</span> <span class="keyword">implements</span> <span class="title">XxxService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">xxx</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 本端是否为提供端，这里会返回true</span></div><div class="line">        <span class="keyword">boolean</span> isProviderSide = RpcContext.getContext().isProviderSide();</div><div class="line">        <span class="comment">// 获取调用方IP地址</span></div><div class="line">        String clientIP = RpcContext.getContext().getRemoteHost();</div><div class="line">        <span class="comment">// 获取当前服务配置信息，所有配置信息都将转换为URL的参数</span></div><div class="line">        String application = RpcContext.getContext().getUrl().getParameter(<span class="string">"application"</span>);</div><div class="line">        <span class="comment">// 注意：每发起RPC调用，上下文状态会变化</span></div><div class="line">        yyyService.yyy();</div><div class="line">        <span class="comment">// 此时本端变成消费端，这里会返回false</span></div><div class="line">        <span class="keyword">boolean</span> isProviderSide = RpcContext.getContext().isProviderSide();</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="隐式参数"><a href="#隐式参数" class="headerlink" title="隐式参数"></a>隐式参数</h2><blockquote>
<p>可以通过 <code>RpcContext</code> 上的 <code>setAttachment</code> 和 <code>getAttachment</code> 在服务消费方和提供方之间进行参数的隐式传递。 <a href="http://dubbo.apache.org/books/dubbo-user-book/demos/attachment.html#fn_1" target="_blank" rel="external">1</a></p>
</blockquote>
<p><img src="http://dubbo.apache.org/books/dubbo-user-book/sources/images/context.png" alt="/user-guide/images/context.png"></p>
<h3 id="在服务消费方端设置隐式参数"><a href="#在服务消费方端设置隐式参数" class="headerlink" title="在服务消费方端设置隐式参数"></a>在服务消费方端设置隐式参数</h3><blockquote>
<p><code>setAttachment</code> 设置的 KV 对，在完成下面一次远程调用会被清空，即多次远程调用要多次设置。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RpcContext.getContext().setAttachment(<span class="string">"index"</span>, <span class="string">"1"</span>); <span class="comment">// 隐式传参，后面的远程调用都会隐式将这些参数发送到服务器端，类似cookie，用于框架集成，不建议常规业务使用</span></div><div class="line">xxxService.xxx(); <span class="comment">// 远程调用</span></div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure>
<h3 id="在服务提供方端获取隐式参数"><a href="#在服务提供方端获取隐式参数" class="headerlink" title="在服务提供方端获取隐式参数"></a>在服务提供方端获取隐式参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XxxServiceImpl</span> <span class="keyword">implements</span> <span class="title">XxxService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">xxx</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取客户端隐式传入的参数，用于框架集成，不建议常规业务使用</span></div><div class="line">        String index = RpcContext.getContext().getAttachment(<span class="string">"index"</span>); </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>注意：path, group, version, dubbo, token, timeout 几个 key 是保留字段，请使用其它值。<a href="http://dubbo.apache.org/books/dubbo-user-book/demos/attachment.html#reffn_1" target="_blank" rel="external"> ↩</a></li>
</ol>
</blockquote>
<h2 id="异步调用"><a href="#异步调用" class="headerlink" title="异步调用"></a>异步调用</h2><p>基于 NIO 的非阻塞实现并行调用，客户端不需要启动多线程即可完成并行调用多个远程服务，相对多线程开销较小。 <a href="http://dubbo.apache.org/books/dubbo-user-book/demos/async-call.html#fn_1" target="_blank" rel="external">1</a></p>
<p><img src="http://dubbo.apache.org/books/dubbo-user-book/sources/images/future.jpg" alt="/user-guide/images/future.jpg"></p>
<p>在 consumer.xml 中配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"fooService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.foo.FooService"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"findFoo"</span> <span class="attr">async</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.bar.BarService"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"findBar"</span> <span class="attr">async</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></div></pre></td></tr></table></figure>
<p>调用代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 此调用会立即返回null</span></div><div class="line">fooService.findFoo(fooId);</div><div class="line"><span class="comment">// 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future</span></div><div class="line">Future&lt;Foo&gt; fooFuture = RpcContext.getContext().getFuture(); </div><div class="line"></div><div class="line"><span class="comment">// 此调用会立即返回null</span></div><div class="line">barService.findBar(barId);</div><div class="line"><span class="comment">// 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future</span></div><div class="line">Future&lt;Bar&gt; barFuture = RpcContext.getContext().getFuture(); </div><div class="line"></div><div class="line"><span class="comment">// 此时findFoo和findBar的请求同时在执行，客户端不需要启动多线程来支持并行，而是借助NIO的非阻塞完成</span></div><div class="line"></div><div class="line"><span class="comment">// 如果foo已返回，直接拿到返回值，否则线程wait住，等待foo返回后，线程会被notify唤醒</span></div><div class="line">Foo foo = fooFuture.get(); </div><div class="line"><span class="comment">// 同理等待bar返回</span></div><div class="line">Bar bar = barFuture.get(); </div><div class="line"></div><div class="line"><span class="comment">// 如果foo需要5秒返回，bar需要6秒返回，实际只需等6秒，即可获取到foo和bar，进行接下来的处理。</span></div></pre></td></tr></table></figure>
<p>你也可以设置是否等待消息发出： <a href="http://dubbo.apache.org/books/dubbo-user-book/demos/async-call.html#fn_2" target="_blank" rel="external">2</a></p>
<ul>
<li><code>sent=&quot;true&quot;</code> 等待消息发出，消息发送失败将抛出异常。</li>
<li><code>sent=&quot;false&quot;</code> 不等待消息发出，将消息放入 IO 队列，即刻返回。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"findFoo"</span> <span class="attr">async</span>=<span class="string">"true"</span> <span class="attr">sent</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>如果你只是想异步，完全忽略返回值，可以配置 <code>return=&quot;false&quot;</code>，以减少 Future 对象的创建和管理成本：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"findFoo"</span> <span class="attr">async</span>=<span class="string">"true"</span> <span class="attr">return</span>=<span class="string">"false"</span> /&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<ol>
<li><p><code>2.0.6</code> 及其以上版本支持<a href="http://dubbo.apache.org/books/dubbo-user-book/demos/async-call.html#reffn_1" target="_blank" rel="external"> ↩</a></p>
</li>
<li><p>异步总是不等待返回<a href="http://dubbo.apache.org/books/dubbo-user-book/demos/async-call.html#reffn_2" target="_blank" rel="external"> ↩</a></p>
</li>
</ol>
</blockquote>
<h2 id="本地存根"><a href="#本地存根" class="headerlink" title="本地存根"></a>本地存根</h2><ul>
<li><p><strong>dubbo的本地存根的原理是：</strong>远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，那么就在服务消费者这一端提供了一个Stub类，然后当消费者调用provider方提供的dubbo服务时，客户端生成 Proxy 实例，这个Proxy实例就是我们正常调用dubbo远程服务要生成的代理实例，然后消费者这方会把 Proxy 通过构造函数传给 消费者方的Stub ，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。会通过代理类去完成这个调用，这样在Stub类中，就可以做一些额外的事，来对服务的调用过程进行优化或者容错的处理。附图：</p>
<p><img src="https://images2017.cnblogs.com/blog/296430/201801/296430-20180109111413879-348600461.png" alt="img"></p>
</li>
<li><p><strong>总结：如果消费者想用在调用远程服务的同时还想在之前或者之后实现自己的部分逻辑，那么就需要在消费者端定义一个代理类，其实在消费者调用服务的时候，实际上是调用的代理类。不过其中代理类返回的数据是可以传递给服务提供者的</strong></p>
</li>
</ul>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><p> <strong>1. 定义一个服务接口和服务实现类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserInterface</span> </span>&#123;</div><div class="line">    </div><div class="line">    </div><div class="line">       <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span> </span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserInterface</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line">        User user  = <span class="keyword">new</span> User() ;</div><div class="line">        user.setId(id);</div><div class="line">        user.setName(<span class="string">"hu"</span>);</div><div class="line">        <span class="keyword">return</span> user;</div><div class="line">    &#125;  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>服务分布配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:service</span>  <span class="attr">interface</span>=<span class="string">"org.huxin.dubbo.test.user.service.UserInterface"</span> <span class="attr">ref</span>=<span class="string">"userService"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span>    <span class="attr">retries</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">        </div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"org.huxin.dubbo.test.user.service.impl.UserService"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>3.服务消费者的Stub类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceStub</span> <span class="keyword">implements</span> <span class="title">UserInterface</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//必须定义这个接口，以便接收dubbo在调用远程服务生成的服务代理类</span></div><div class="line">    <span class="keyword">private</span> UserInterface userLocalService ;</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//这个构造函数必须要提供，dubbo框架会在消费者这一方调用这个方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceStub</span><span class="params">(UserInterface userLocalService )</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.userLocalService = userLocalService  ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line"></div><div class="line">　　　　　　　　User user = <span class="keyword">null</span> ;</div><div class="line">　　　　　　　　<span class="keyword">try</span> &#123;</div><div class="line">　　　　　　　　　　<span class="keyword">if</span> (id == <span class="number">1</span>) &#123;</div><div class="line">　　　　　　　　　　　　user = <span class="keyword">this</span>.userLocalService.getUserById(id) ;</div><div class="line">　　　　　　　　　　&#125;<span class="keyword">else</span> &#123;</div><div class="line">　　　　　　　　　　　　user = <span class="keyword">new</span> User(); </div><div class="line">　　　　　　　　　　　　user.setName(<span class="string">"系统用户"</span>);</div><div class="line">　　　　　　　　　　&#125;</div><div class="line">　　　　　　　　&#125;<span class="keyword">catch</span>(Exception e) &#123;</div><div class="line">　　　　　　　　　　user = <span class="keyword">new</span> User(); </div><div class="line">　　　　　　　　　　user.setName(<span class="string">"异常用户"</span>);</div><div class="line">　　　　　　　　&#125;</div><div class="line"></div><div class="line">              <span class="keyword">return</span> user ;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>服务消费方的配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">interface</span>=<span class="string">"org.huxin.dubbo.test.user.service.UserInterface"</span> </span></div><div class="line">                   <span class="attr">stub</span>=<span class="string">"org.huxin.dubbo.test.UserServiceStub"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span>/&gt;</div></pre></td></tr></table></figure>
<p>5.测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserById</span><span class="params">()</span></span>&#123;</div><div class="line">        Integer id = <span class="number">2</span> ;</div><div class="line">            UserInterface  userService = context.getBean(UserInterface.class) ;</div><div class="line">        User user = userService.getUserById( id) ;</div><div class="line">        System.out.println(user.getName()); </div><div class="line">         </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>实际上调用<code>getUserById(id)</code>这个方法是代理类<code>UserServiceStub</code>的方法，返回的User对象也是这个这个方法返回的</li>
</ul>
<h2 id="本地伪装"><a href="#本地伪装" class="headerlink" title="本地伪装"></a>本地伪装</h2><ul>
<li><a href="http://dubbo.apache.org/books/dubbo-user-book/demos/local-mock.html" target="_blank" rel="external">本地伪装</a></li>
</ul>
<h2 id="延迟暴露"><a href="#延迟暴露" class="headerlink" title="延迟暴露"></a>延迟暴露</h2><ul>
<li><a href="http://dubbo.apache.org/books/dubbo-user-book/demos/delay-publish.html" target="_blank" rel="external">延迟暴露</a></li>
</ul>
<h2 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h2><ul>
<li><a href="http://dubbo.apache.org/books/dubbo-user-book/demos/concurrency-control.html" target="_blank" rel="external">并发控制</a></li>
</ul>
<h2 id="连接控制"><a href="#连接控制" class="headerlink" title="连接控制"></a>连接控制</h2><ul>
<li>限制连接个数</li>
<li><a href="http://dubbo.apache.org/books/dubbo-user-book/demos/concurrency-control.html" target="_blank" rel="external">连接控制</a></li>
</ul>
<h2 id="延迟连接"><a href="#延迟连接" class="headerlink" title="延迟连接"></a>延迟连接</h2><ul>
<li><a href="http://dubbo.apache.org/books/dubbo-user-book/demos/lazy-connect.html" target="_blank" rel="external">延迟连接</a></li>
</ul>
<h2 id="粘滞连接"><a href="#粘滞连接" class="headerlink" title="粘滞连接"></a>粘滞连接</h2><p>粘滞连接用于有状态服务，尽可能让客户端总是向同一提供者发起调用，除非该提供者挂了，再连另一台。</p>
<p>粘滞连接将自动开启<a href="http://dubbo.apache.org/books/dubbo-user-book/demos/lazy-connect.html" target="_blank" rel="external">延迟连接</a>，以减少长连接数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">sticky</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="笔者有话说"><a href="#笔者有话说" class="headerlink" title="笔者有话说"></a>笔者有话说</h2><ul>
<li>最近建了一个微信交流群，提供给大家一个交流的平台，扫描下方笔者的微信二维码，备注【交流】，我会把大家拉进群</li>
</ul>
<p><img src="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200310211704.jpg" alt=""></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/分布式/">分布式</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/分布式/">分布式</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://chenjiabing666.github.io/2018/06/26/Dubbo使用总结/" data-title="Dubbo使用总结 | 爱撒谎的男孩" data-tsina="5651317821" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/06/26/Git使用总结/" title="Git使用总结">
  <strong>上一篇：</strong><br/>
  <span>
  Git使用总结</span>
</a>
</div>


<div class="next">
<a href="/2018/06/26/Spring整合Redis/"  title="Spring整合Redis">
 <strong>下一篇：</strong><br/> 
 <span>Spring整合Redis
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Dubbo常见问题"><span class="toc-number">1.</span> <span class="toc-text">Dubbo常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#官方文档"><span class="toc-number">1.1.</span> <span class="toc-text">官方文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动检查"><span class="toc-number">1.2.</span> <span class="toc-text">启动检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置方式"><span class="toc-number">1.2.1.</span> <span class="toc-text">配置方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭某个服务的检查"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">关闭某个服务的检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭所有服务的检查"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">关闭所有服务的检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭注册中心启动时检查"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">关闭注册中心启动时检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dubbo-properties"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">dubbo.properties</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#负载均衡策略"><span class="toc-number">1.3.</span> <span class="toc-text">负载均衡策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多协议"><span class="toc-number">1.4.</span> <span class="toc-text">多协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#不同服务不同协议"><span class="toc-number">1.4.1.</span> <span class="toc-text">不同服务不同协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多协议暴露服务"><span class="toc-number">1.4.2.</span> <span class="toc-text">多协议暴露服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多版本"><span class="toc-number">1.5.</span> <span class="toc-text">多版本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">1.5.1.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务分组"><span class="toc-number">1.6.</span> <span class="toc-text">服务分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务"><span class="toc-number">1.6.1.</span> <span class="toc-text">服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引用"><span class="toc-number">1.6.2.</span> <span class="toc-text">引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#令牌验证"><span class="toc-number">1.7.</span> <span class="toc-text">令牌验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dubbo控制台的安装部署"><span class="toc-number">1.8.</span> <span class="toc-text">dubbo控制台的安装部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程模型"><span class="toc-number">1.9.</span> <span class="toc-text">线程模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多注册中心"><span class="toc-number">1.10.</span> <span class="toc-text">多注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多注册中心注册"><span class="toc-number">1.10.1.</span> <span class="toc-text">多注册中心注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同服务使用不同注册中心"><span class="toc-number">1.10.2.</span> <span class="toc-text">不同服务使用不同注册中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多注册中心引用"><span class="toc-number">1.10.3.</span> <span class="toc-text">多注册中心引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分组聚合"><span class="toc-number">1.11.</span> <span class="toc-text">分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">1.11.1.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置文件覆盖策略"><span class="toc-number">1.12.</span> <span class="toc-text">配置文件覆盖策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回声测试"><span class="toc-number">1.13.</span> <span class="toc-text">回声测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#上下文信息"><span class="toc-number">1.14.</span> <span class="toc-text">上下文信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务消费方"><span class="toc-number">1.14.1.</span> <span class="toc-text">服务消费方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务提供方"><span class="toc-number">1.14.2.</span> <span class="toc-text">服务提供方</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#隐式参数"><span class="toc-number">1.15.</span> <span class="toc-text">隐式参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在服务消费方端设置隐式参数"><span class="toc-number">1.15.1.</span> <span class="toc-text">在服务消费方端设置隐式参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在服务提供方端获取隐式参数"><span class="toc-number">1.15.2.</span> <span class="toc-text">在服务提供方端获取隐式参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异步调用"><span class="toc-number">1.16.</span> <span class="toc-text">异步调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#本地存根"><span class="toc-number">1.17.</span> <span class="toc-text">本地存根</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现步骤"><span class="toc-number">1.17.1.</span> <span class="toc-text">实现步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.17.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#本地伪装"><span class="toc-number">1.18.</span> <span class="toc-text">本地伪装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延迟暴露"><span class="toc-number">1.19.</span> <span class="toc-text">延迟暴露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发控制"><span class="toc-number">1.20.</span> <span class="toc-text">并发控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接控制"><span class="toc-number">1.21.</span> <span class="toc-text">连接控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延迟连接"><span class="toc-number">1.22.</span> <span class="toc-text">延迟连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#粘滞连接"><span class="toc-number">1.23.</span> <span class="toc-text">粘滞连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#笔者有话说"><span class="toc-number">1.24.</span> <span class="toc-text">笔者有话说</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hibernate/" title="Hibernate">Hibernate<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Web/" title="Java-Web">Java-Web<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/MyBatis/" title="MyBatis">MyBatis<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring/" title="Spring">Spring<sup>39</sup></a></li>
		  
		
		  
			<li><a href="/categories/SpringBoot/" title="SpringBoot">SpringBoot<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/Struts2/" title="Struts2">Struts2<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker/" title="docker">docker<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/java学习/" title="java学习">java学习<sup>35</sup></a></li>
		  
		
		  
			<li><a href="/categories/java并发编程/" title="java并发编程">java并发编程<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>19</sup></a></li>
		  
		
		  
			<li><a href="/categories/web前端/" title="web前端">web前端<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/分布式/" title="分布式">分布式<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库干货篇/" title="数据库干货篇">数据库干货篇<sup>20</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂谈/" title="杂谈">杂谈<sup>22</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>9</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>39</sup></a></li>
			
		
			
				<li><a href="/tags/杂谈/" title="杂谈">杂谈<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/java基础/" title="java基础">java基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/python爬虫/" title="python爬虫">python爬虫<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/java并发编程/" title="java并发编程">java并发编程<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/SpringBoot/" title="SpringBoot">SpringBoot<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/SQL/" title="SQL">SQL<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/分布式/" title="分布式">分布式<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Struts2/" title="Struts2">Struts2<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/java-IO编程/" title="java IO编程">java IO编程<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Redis/" title="Redis">Redis<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/MyBatis/" title="MyBatis">MyBatis<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/web前端/" title="web前端">web前端<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://gitee.com/chenjiabing666/Blog-file/raw/master/%E4%B8%83%E7%A7%92%E7%BC%96%E7%A8%8B.jpg" target="_blank" title="微信公众号">微信公众号</a>
            
          </li>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.zhihu.com/people/xiao-ming-64-34-45/activities" target="_blank" title="本人知乎">本人知乎</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.cnblogs.com/Chenjiabing/" target="_blank" title="本人博客园">本人博客园</a>
            
          </li>
        
          <li>
            
            	<a href="https://blog.csdn.net/qq_34162294" target="_blank" title="本人CSDN">本人CSDN</a>
            
          </li>
        
          <li>
            
            	<a href="https://juejin.im/user/2506542244708072" target="_blank" title="本人掘金">本人掘金</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 欢迎关注微信公众号：码猿技术专栏 <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	 <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=14509119671822169205' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5651317821" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/chenjiabing666" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/155022807" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/https://www.zhihu.com/people/xiao-ming-64-34-45" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="不才陈某">不才陈某</a>
		
		
		</p>
		
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    $('#toc.toc-aside').css('display', 'block').addClass('fadeIn');//新加的，打开文章时自动隐藏左边的栏
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'chenjiabing666';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261577779'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s23.cnzz.com/z_stat.php%3Fid%3D1261577779' type='text/javascript'%3E%3C/script%3E"));</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

    <script type="text/javascript" src="/js/src/love.js"></script>

  </body>
  
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</html>
